{"version":3,"file":"index.js","sources":["../../src/layers/LayerContext.tsx","../../src/manager/context.tsx","../../src/manager/useLayerManager.tsx","../../src/layers/useLayer.tsx","../../src/layers/LayerNode.tsx","../../src/events/LayerEventContext.tsx","../../src/layers/LayerContextProvider.tsx","../../src/manager/actions.tsx","../../src/events/LayerHandlers.ts","../../src/events/RenderLayerIndicator.tsx","../../src/events/LayerEventContextProvider.tsx","../../src/layers/DefaultLayer/EditableLayerName.tsx","../../src/layers/DefaultLayer/svg/arrow.svg","../../src/layers/DefaultLayer/svg/eye.svg","../../src/layers/DefaultLayer/svg/linked.svg","../../src/theme.ts","../../src/layers/ThemeContext.tsx","../../src/layers/DefaultLayer/DefaultLayerHeader.tsx","../../src/layers/DefaultLayer/DefaultLayer.tsx","../../src/manager/LayerManagerProvider.tsx","../../src/index.tsx"],"sourcesContent":["import { NodeId } from '@craftjs/core';\nimport { EventHandlerConnectors } from '@craftjs/utils';\nimport React from 'react';\n\nimport { LayerHandlers } from '../events/LayerHandlers';\n\nexport type LayerContextType = {\n  id: NodeId;\n  depth: number;\n  connectors: EventHandlerConnectors<LayerHandlers, React.ReactElement>;\n};\n\nexport const LayerContext = React.createContext<LayerContextType>(\n  {} as LayerContextType\n);\n","import { SubscriberAndCallbacksFor } from '@craftjs/utils';\nimport { createContext } from 'react';\n\nimport { LayerMethods } from './actions';\n\nexport type LayerStore = SubscriberAndCallbacksFor<typeof LayerMethods>;\nexport type LayerManagerContextType = {\n  store: LayerStore;\n};\n\nexport const LayerManagerContext = createContext<LayerManagerContextType>(\n  {} as LayerManagerContextType\n);\n","import { useCollector } from '@craftjs/utils';\nimport { useContext, useMemo } from 'react';\n\nimport { LayerManagerContext } from './context';\n\nimport { LayerState } from '../interfaces';\n\nexport function useLayerManager<C>(collector?: (state: LayerState) => C) {\n  const { store } = useContext(LayerManagerContext);\n  const collected = useCollector(store, collector);\n\n  return useMemo(\n    () => ({\n      store,\n      ...collected,\n    }),\n    [store, collected]\n  );\n}\n","import { useEditor } from '@craftjs/core';\nimport { wrapConnectorHooks } from '@craftjs/utils';\nimport { useContext, useMemo } from 'react';\n\nimport { LayerContext } from './LayerContext';\n\nimport { Layer } from '../interfaces';\nimport { useLayerManager } from '../manager';\n\nexport function useLayer<S = null>(collect?: (layer: Layer) => S) {\n  const { id, depth, connectors: internalConnectors } = useContext(\n    LayerContext\n  );\n\n  const { actions: managerActions, ...collected } = useLayerManager((state) => {\n    return id && state.layers[id] && collect && collect(state.layers[id]);\n  });\n\n  const { children } = useEditor((state, query) => ({\n    children: state.nodes[id] && query.node(id).descendants(),\n  }));\n\n  const actions = useMemo(() => {\n    return {\n      toggleLayer: () => managerActions.toggleLayer(id),\n      setExpandedState: (expanded: boolean) =>\n        managerActions.setExpandedState(id, expanded),\n    };\n  }, [managerActions, id]);\n\n  const connectors = useMemo(\n    () =>\n      wrapConnectorHooks({\n        layer: (el: HTMLElement) => internalConnectors.layer(el, id),\n        drag: (el: HTMLElement) => internalConnectors.drag(el, id),\n        layerHeader: (el: HTMLElement) =>\n          internalConnectors.layerHeader(el, id),\n      }),\n    [internalConnectors, id]\n  );\n\n  return {\n    id,\n    depth,\n    children,\n    actions,\n    connectors,\n    ...collected,\n  };\n}\n","import { useEditor, ROOT_NODE } from '@craftjs/core';\nimport React, { useRef, useEffect, useLayoutEffect, useState } from 'react';\n\nimport { LayerContextProvider } from './LayerContextProvider';\nimport { useLayer } from './useLayer';\n\nimport { useLayerManager } from '../manager/useLayerManager';\n\nexport const LayerNode = () => {\n  const { id, depth, children, expanded } = useLayer((layer) => ({\n    expanded: layer.expanded,\n  }));\n\n  const { data, shouldBeExpanded } = useEditor((state, query) => {\n    // TODO: handle multiple selected elements\n    const selected = query.getEvent('selected').first();\n\n    return {\n      data: state.nodes[id] && state.nodes[id].data,\n      shouldBeExpanded:\n        selected && query.node(selected).ancestors(true).includes(id),\n    };\n  });\n\n  const {\n    actions: { registerLayer, toggleLayer },\n    renderLayer,\n    expandRootOnLoad,\n  } = useLayerManager((state) => ({\n    renderLayer: state.options.renderLayer,\n    expandRootOnLoad: state.options.expandRootOnLoad,\n  }));\n\n  const [isRegistered, setRegistered] = useState(false);\n\n  useLayoutEffect(() => {\n    registerLayer(id);\n    setRegistered(true);\n  }, [registerLayer, id]);\n\n  const expandedRef = useRef<boolean>(expanded);\n  expandedRef.current = expanded;\n\n  const shouldBeExpandedOnLoad = useRef<boolean>(\n    expandRootOnLoad && id === ROOT_NODE\n  );\n\n  useEffect(() => {\n    if (!expandedRef.current && shouldBeExpanded) {\n      toggleLayer(id);\n    }\n  }, [toggleLayer, id, shouldBeExpanded]);\n\n  useEffect(() => {\n    if (shouldBeExpandedOnLoad.current) {\n      toggleLayer(id);\n    }\n  }, [toggleLayer, id]);\n\n  return data && isRegistered ? (\n    <div className={`craft-layer-node ${id}`}>\n      {React.createElement(\n        renderLayer,\n        {},\n        children && expanded\n          ? children.map((id) => (\n              <LayerContextProvider key={id} id={id} depth={depth + 1} />\n            ))\n          : null\n      )}\n    </div>\n  ) : null;\n};\n","import { createContext, useContext } from 'react';\n\nimport { LayerHandlers } from './LayerHandlers';\n\nexport const LayerEventHandlerContext = createContext<LayerHandlers>(null);\n\nexport const useLayerEventHandler = () => useContext(LayerEventHandlerContext);\n","import { useEditor } from '@craftjs/core';\nimport { wrapConnectorHooks } from '@craftjs/utils';\nimport React, { useMemo, useContext, useRef, useEffect } from 'react';\n\nimport { LayerContext, LayerContextType } from './LayerContext';\nimport { LayerNode } from './LayerNode';\n\nimport { useLayerEventHandler } from '../events/LayerEventContext';\nimport { LayerManagerContext } from '../manager';\n\nexport type LayerContextProviderProps = Omit<LayerContextType, 'connectors'>;\n\nexport const LayerContextProvider = ({\n  id,\n  depth,\n}: LayerContextProviderProps) => {\n  const handlers = useLayerEventHandler();\n\n  const { store } = useContext(LayerManagerContext);\n  const storeRef = useRef(store);\n  storeRef.current = store;\n\n  const connectorsUsage = useMemo(() => handlers.createConnectorsUsage(), [\n    handlers,\n  ]);\n\n  const connectors = useMemo(\n    () => wrapConnectorHooks(connectorsUsage.connectors),\n    [connectorsUsage]\n  );\n\n  useEffect(() => {\n    connectorsUsage.register();\n\n    return () => {\n      connectorsUsage.cleanup();\n    };\n  }, [connectorsUsage]);\n\n  const { exists } = useEditor((state) => ({\n    exists: !!state.nodes[id],\n  }));\n\n  if (!exists) {\n    return null;\n  }\n\n  return (\n    <LayerContext.Provider value={{ id, depth, connectors }}>\n      <LayerNode />\n    </LayerContext.Provider>\n  );\n};\n","import { LayerState, LayerEvents } from '../interfaces';\n\nexport const LayerMethods = (state: LayerState) => ({\n  setLayerEvent: (eventType: LayerEvents, id: string) => {\n    if (id !== null && !state.layers[id]) return;\n\n    const current = state.events[eventType];\n    if (current && id !== current) {\n      state.layers[current].event[eventType] = false;\n    }\n\n    if (id) {\n      state.layers[id].event[eventType] = true;\n      state.events[eventType] = id;\n    } else {\n      state.events[eventType] = null;\n    }\n  },\n  registerLayer: (id: string) => {\n    if (!state.layers[id]) {\n      state.layers[id] = {\n        dom: null,\n        headingDom: null,\n        expanded: false,\n        id,\n        event: {\n          selected: false,\n          hovered: false,\n        },\n      };\n    }\n  },\n  setDOM: (\n    id: string,\n    domCollection: Partial<Record<'dom' | 'headingDom', HTMLElement>>\n  ) => {\n    state.layers[id] = {\n      ...state.layers[id],\n      ...(domCollection.dom ? { dom: domCollection.dom } : {}),\n      ...(domCollection.headingDom\n        ? { headingDom: domCollection.headingDom }\n        : {}),\n    };\n  },\n  toggleLayer: (id: string) => {\n    state.layers[id].expanded = !state.layers[id].expanded;\n  },\n  setExpandedState: (id: string, expanded: boolean) => {\n    state.layers[id].expanded = expanded;\n  },\n  setIndicator: (indicator) => {\n    state.events.indicator = indicator;\n  },\n});\n","import { NodeId, Node, DerivedCoreEventHandlers } from '@craftjs/core';\n\nimport { LayerIndicator } from '../interfaces';\n\nexport class LayerHandlers extends DerivedCoreEventHandlers<{\n  layerStore: any;\n}> {\n  static draggedElement;\n  static events: {\n    indicator: LayerIndicator;\n    currentCanvasHovered: Node;\n  } = {\n    indicator: null,\n    currentCanvasHovered: null,\n  };\n\n  getLayer(id: NodeId) {\n    return this.options.layerStore.getState().layers[id];\n  }\n\n  handlers() {\n    const editorStore = this.derived.options.store;\n    const { layerStore } = this.options;\n    return {\n      layer: (el: HTMLElement, layerId: NodeId) => {\n        layerStore.actions.setDOM(layerId, {\n          dom: el,\n        });\n\n        const cleanupParentConnectors = this.inherit((connectors) => {\n          connectors.select(el, layerId);\n          connectors.hover(el, layerId);\n          connectors.drag(el, layerId);\n        });\n\n        const unbindMouseOver = this.addCraftEventListener(\n          el,\n          'mouseover',\n          (e) => {\n            e.craft.stopPropagation();\n            layerStore.actions.setLayerEvent('hovered', layerId);\n          }\n        );\n\n        let unbindMouseleave: (() => void) | null = null;\n\n        if (this.derived.options.removeHoverOnMouseleave) {\n          unbindMouseleave = this.addCraftEventListener(\n            el,\n            'mouseleave',\n            (e) => {\n              e.craft.stopPropagation();\n              layerStore.actions.setLayerEvent('hovered', null);\n            }\n          );\n        }\n\n        const unbindDragOver = this.addCraftEventListener(\n          el,\n          'dragover',\n          (e) => {\n            e.craft.stopPropagation();\n            e.preventDefault();\n\n            const { indicator, currentCanvasHovered } = LayerHandlers.events;\n\n            if (currentCanvasHovered && indicator) {\n              const heading = this.getLayer(\n                currentCanvasHovered.id\n              ).headingDom.getBoundingClientRect();\n\n              if (\n                e.clientY > heading.top + 10 &&\n                e.clientY < heading.bottom - 10\n              ) {\n                const currNode =\n                  currentCanvasHovered.data.nodes[\n                    currentCanvasHovered.data.nodes.length - 1\n                  ];\n\n                if (!currNode) {\n                  // If the currentCanvasHovered has no child nodes, then we place the indicator as the first child\n                  LayerHandlers.events.indicator = {\n                    ...indicator,\n                    placement: {\n                      ...indicator.placement,\n                      index: 0,\n                      where: 'before',\n                      parent: currentCanvasHovered,\n                    },\n                    onCanvas: true,\n                  };\n                  return;\n                }\n\n                LayerHandlers.events.indicator = {\n                  ...indicator,\n                  placement: {\n                    currentNode: editorStore.query.node(currNode).get(),\n                    index: currentCanvasHovered.data.nodes.length,\n                    where: 'after',\n                    parent: currentCanvasHovered,\n                  },\n                  onCanvas: true,\n                };\n\n                layerStore.actions.setIndicator(LayerHandlers.events.indicator);\n              }\n            }\n          }\n        );\n\n        const unbindDragEnter = this.addCraftEventListener(\n          el,\n          'dragenter',\n          (e) => {\n            e.craft.stopPropagation();\n            e.preventDefault();\n\n            const dragId = LayerHandlers.draggedElement;\n\n            if (!dragId) return;\n\n            let target = layerId;\n\n            const indicatorInfo = editorStore.query.getDropPlaceholder(\n              dragId,\n              target,\n              { x: e.clientX, y: e.clientY },\n              (node) => {\n                const layer = this.getLayer(node.id);\n                return layer && layer.dom;\n              }\n            );\n\n            if (indicatorInfo) {\n              const {\n                placement: { parent },\n              } = indicatorInfo;\n              const parentHeadingInfo = this.getLayer(\n                parent.id\n              ).headingDom.getBoundingClientRect();\n\n              LayerHandlers.events.currentCanvasHovered = null;\n              if (editorStore.query.node(parent.id).isCanvas()) {\n                if (parent.data.parent) {\n                  const grandparent = editorStore.query\n                    .node(parent.data.parent)\n                    .get();\n                  if (editorStore.query.node(grandparent.id).isCanvas()) {\n                    LayerHandlers.events.currentCanvasHovered = parent;\n                    if (\n                      (e.clientY > parentHeadingInfo.bottom - 10 &&\n                        !this.getLayer(parent.id).expanded) ||\n                      e.clientY < parentHeadingInfo.top + 10\n                    ) {\n                      indicatorInfo.placement.parent = grandparent;\n                      indicatorInfo.placement.currentNode = parent;\n                      indicatorInfo.placement.index = grandparent.data.nodes\n                        ? grandparent.data.nodes.indexOf(parent.id)\n                        : 0;\n                      if (\n                        e.clientY > parentHeadingInfo.bottom - 10 &&\n                        !this.getLayer(parent.id).expanded\n                      ) {\n                        indicatorInfo.placement.where = 'after';\n                      } else if (e.clientY < parentHeadingInfo.top + 10) {\n                        indicatorInfo.placement.where = 'before';\n                      }\n                    }\n                  }\n                }\n              }\n\n              LayerHandlers.events.indicator = {\n                ...indicatorInfo,\n                onCanvas: false,\n              };\n\n              layerStore.actions.setIndicator(LayerHandlers.events.indicator);\n            }\n          }\n        );\n\n        return () => {\n          cleanupParentConnectors();\n          unbindMouseOver();\n          unbindDragOver();\n          unbindDragEnter();\n\n          if (!unbindMouseleave) {\n            return;\n          }\n\n          unbindMouseleave();\n        };\n      },\n      layerHeader: (el: HTMLElement, layerId: NodeId) => {\n        layerStore.actions.setDOM(layerId, {\n          headingDom: el,\n        });\n      },\n      drag: (el: HTMLElement, layerId: NodeId) => {\n        el.setAttribute('draggable', 'true');\n\n        const unbindDragStart = this.addCraftEventListener(\n          el,\n          'dragstart',\n          (e) => {\n            e.craft.stopPropagation();\n            LayerHandlers.draggedElement = layerId;\n          }\n        );\n\n        const unbindDragEnd = this.addCraftEventListener(el, 'dragend', (e) => {\n          e.craft.stopPropagation();\n          const events = LayerHandlers.events;\n\n          if (events.indicator && !events.indicator.error) {\n            const { placement } = events.indicator;\n            const { parent, index, where } = placement;\n            const { id: parentId } = parent;\n\n            editorStore.actions.move(\n              LayerHandlers.draggedElement as NodeId,\n              parentId,\n              index + (where === 'after' ? 1 : 0)\n            );\n          }\n\n          LayerHandlers.draggedElement = null;\n          LayerHandlers.events.indicator = null;\n          layerStore.actions.setIndicator(null);\n        });\n\n        return () => {\n          el.removeAttribute('draggable');\n          unbindDragStart();\n          unbindDragEnd();\n        };\n      },\n    };\n  }\n}\n","import { useEditor } from '@craftjs/core';\nimport { RenderIndicator } from '@craftjs/utils';\nimport React, { useMemo } from 'react';\n\nimport { useLayerManager } from '../manager/useLayerManager';\n\ntype RenderLayerIndicatorProps = {\n  children?: React.ReactNode;\n};\n\nexport const RenderLayerIndicator = ({\n  children,\n}: RenderLayerIndicatorProps) => {\n  const { layers, events } = useLayerManager((state) => state);\n  const { query } = useEditor((state) => ({ enabled: state.options.enabled }));\n  const { indicator: indicatorStyles } = query.getOptions();\n\n  const indicatorPosition = useMemo(() => {\n    const { indicator } = events;\n\n    if (indicator) {\n      const {\n        placement: { where, parent, currentNode },\n        error,\n      } = indicator;\n      const layerId = currentNode ? currentNode.id : parent.id;\n\n      let top;\n      const color = error ? indicatorStyles.error : indicatorStyles.success;\n\n      if (indicator.onCanvas && layers[parent.id].dom != null) {\n        const parentPos = layers[parent.id].dom.getBoundingClientRect();\n        const parentHeadingPos = layers[\n          parent.id\n        ].headingDom.getBoundingClientRect();\n        return {\n          top: parentHeadingPos.top,\n          left: parentPos.left,\n          width: parentPos.width,\n          height: parentHeadingPos.height,\n          background: 'transparent',\n          borderWidth: '1px',\n          borderColor: color,\n        };\n      } else {\n        if (!layers[layerId]) return;\n        const headingPos = layers[layerId].headingDom.getBoundingClientRect();\n        const pos = layers[layerId].dom.getBoundingClientRect();\n\n        if (where === 'after' || !currentNode) {\n          top = pos.top + pos.height;\n        } else {\n          top = pos.top;\n        }\n\n        return {\n          top,\n          left: headingPos.left,\n          width: pos.width + pos.left - headingPos.left,\n          height: 2,\n          borderWidth: 0,\n          background: color,\n        };\n      }\n    }\n  }, [events, indicatorStyles.error, indicatorStyles.success, layers]);\n\n  return (\n    <div>\n      {events.indicator\n        ? React.createElement(RenderIndicator, {\n            style: indicatorPosition,\n          })\n        : null}\n      {children}\n    </div>\n  );\n};\n","import { useEventHandler } from '@craftjs/core';\nimport React, { useMemo } from 'react';\n\nimport { LayerEventHandlerContext } from './LayerEventContext';\nimport { LayerHandlers } from './LayerHandlers';\nimport { RenderLayerIndicator } from './RenderLayerIndicator';\n\nimport { useLayerManager } from '../manager';\n\nexport const LayerEventContextProvider = ({ children }) => {\n  const { store: layerStore } = useLayerManager();\n  const coreEventHandler = useEventHandler();\n\n  const handler = useMemo(\n    () =>\n      coreEventHandler.derive(LayerHandlers, {\n        layerStore,\n      }),\n    [coreEventHandler, layerStore]\n  );\n\n  return (\n    <LayerEventHandlerContext.Provider value={handler}>\n      <RenderLayerIndicator />\n      {children}\n    </LayerEventHandlerContext.Provider>\n  );\n};\n","import { useEditor } from '@craftjs/core';\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport ContentEditable from 'react-contenteditable';\n\nimport { useLayer } from '../useLayer';\n\nexport const EditableLayerName = () => {\n  const { id } = useLayer();\n\n  const { displayName, actions } = useEditor((state) => ({\n    displayName:\n      state.nodes[id] && state.nodes[id].data.custom.displayName\n        ? state.nodes[id].data.custom.displayName\n        : state.nodes[id].data.displayName,\n    hidden: state.nodes[id] && state.nodes[id].data.hidden,\n  }));\n\n  const [editingName, setEditingName] = useState(false);\n  const nameDOM = useRef<HTMLElement | null>(null);\n\n  const clickOutside = useCallback((e) => {\n    if (nameDOM.current && !nameDOM.current.contains(e.target)) {\n      setEditingName(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    return () => {\n      window.removeEventListener('click', clickOutside);\n    };\n  }, [clickOutside]);\n\n  return (\n    <ContentEditable\n      html={displayName}\n      disabled={!editingName}\n      ref={(ref: any) => {\n        if (ref) {\n          nameDOM.current = ref.el.current;\n          window.removeEventListener('click', clickOutside);\n          window.addEventListener('click', clickOutside);\n        }\n      }}\n      onChange={(e) => {\n        actions.setCustom(\n          id,\n          (custom) => (custom.displayName = e.target.value)\n        );\n      }}\n      tagName=\"h2\"\n      onDoubleClick={() => {\n        if (!editingName) setEditingName(true);\n      }}\n    />\n  );\n};\n","<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 10 6\">\n  <title>ChevronDownMedium</title>\n  <rect id=\"ToDelete\" fill=\"#ff13dc\" opacity=\"0\" /><path d=\"M9.99,1.01A.9999.9999,0,0,0,8.28266.30327L5,3.58594,1.71734.30327A.9999.9999,0,1,0,.30327,1.71734L4.29266,5.69673a.99965.99965,0,0,0,1.41468,0L9.69673,1.71734A.99669.99669,0,0,0,9.99,1.01Z\" />\n</svg>","<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\"><path fill=\"none\" d=\"M0 0h24v24H0z\"/><path d=\"M1.181 12C2.121 6.88 6.608 3 12 3c5.392 0 9.878 3.88 10.819 9-.94 5.12-5.427 9-10.819 9-5.392 0-9.878-3.88-10.819-9zM12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0-2a3 3 0 1 1 0-6 3 3 0 0 1 0 6z\"/></svg>","<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 18 18\">\n  <defs>\n    <!-- <style>\n      .a {\n        fill: #707070;\n      }\n    </style> -->\n  </defs>\n  <title>S LinkOut 18 N</title>\n  <rect id=\"Canvas\" opacity=\"0\" /><path class=\"a\" d=\"M16.5,9h-1a.5.5,0,0,0-.5.5V15H3V3H8.5A.5.5,0,0,0,9,2.5v-1A.5.5,0,0,0,8.5,1h-7a.5.5,0,0,0-.5.5v15a.5.5,0,0,0,.5.5h15a.5.5,0,0,0,.5-.5v-7A.5.5,0,0,0,16.5,9Z\" />\n  <path class=\"a\" d=\"M16.75,1H11.377A.4.4,0,0,0,11,1.4a.392.392,0,0,0,.1175.28l1.893,1.895L9.4895,7.096a.5.5,0,0,0-.00039.70711l.00039.00039.707.707a.5.5,0,0,0,.707,0l3.5215-3.521L16.318,6.882A.39051.39051,0,0,0,16.6,7a.4.4,0,0,0,.4-.377V1.25A.25.25,0,0,0,16.75,1Z\" />\n</svg>","// Theme configuration for Craft.js Layers\nexport interface LayersTheme {\n  // Background colors\n  bgBase: string;\n  bgHover: string;\n  bgSelected: string;\n  bgCanvas: string;\n\n  // Text colors\n  textPrimary: string;\n  textSelected: string;\n\n  // Icon colors\n  iconPrimary: string;\n  iconSelected: string;\n\n  // Border and shadow\n  borderColor: string;\n  shadowColor: string;\n}\n\n// Light theme (default)\nexport const lightTheme: LayersTheme = {\n  bgBase: 'transparent',\n  bgHover: '#f1f1f1',\n  bgSelected: '#2680eb',\n  bgCanvas: 'rgba(255, 255, 255, 0.02)',\n\n  textPrimary: 'inherit',\n  textSelected: '#fff',\n\n  iconPrimary: '#808184',\n  iconSelected: '#fff',\n\n  borderColor: '#00000012',\n  shadowColor: '#00000014',\n};\n\n// Dark theme\nexport const darkTheme: LayersTheme = {\n  bgBase: 'transparent',\n  bgHover: '#2a2a2a',\n  bgSelected: '#2680eb',\n  bgCanvas: 'rgba(255, 255, 255, 0.05)',\n\n  textPrimary: '#e0e0e0',\n  textSelected: '#fff',\n\n  iconPrimary: '#b0b0b0',\n  iconSelected: '#fff',\n\n  borderColor: '#ffffff12',\n  shadowColor: '#00000040',\n};\n\n// Theme helper function\nexport const getTheme = (mode?: 'light' | 'dark'): LayersTheme => {\n  return mode === 'dark' ? darkTheme : lightTheme;\n};\n","import React, { createContext, useContext, useMemo } from 'react';\n\nimport { LayersTheme, getTheme } from '../theme';\n\ninterface ThemeContextValue {\n  theme: LayersTheme;\n}\n\nconst ThemeContext = createContext<ThemeContextValue | null>(null);\n\nexport interface ThemeProviderProps {\n  theme?: LayersTheme;\n  themeMode?: 'light' | 'dark';\n  children: React.ReactNode;\n}\n\nexport const ThemeProvider = ({\n  theme,\n  themeMode,\n  children,\n}: ThemeProviderProps) => {\n  const value = useMemo<ThemeContextValue>(() => {\n    // Use custom theme if provided, otherwise use themeMode\n    const resolvedTheme = theme || getTheme(themeMode);\n    return { theme: resolvedTheme };\n  }, [theme, themeMode]);\n\n  return (\n    <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>\n  );\n};\n\nexport const useLayerTheme = (): LayersTheme => {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    // Return default light theme if no provider\n    return getTheme('light');\n  }\n  return context.theme;\n};\n","import { useEditor } from '@craftjs/core';\nimport React from 'react';\nimport { styled } from 'styled-components';\n\nimport { EditableLayerName } from './EditableLayerName';\nimport Arrow from './svg/arrow.svg';\nimport Eye from './svg/eye.svg';\nimport Linked from './svg/linked.svg';\n\nimport { LayersTheme } from '../../theme';\nimport { useLayerTheme } from '../ThemeContext';\nimport { useLayer } from '../useLayer';\n\nconst StyledDiv = styled.div<{\n  $depth: number;\n  $selected: boolean;\n  $theme: LayersTheme;\n}>`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding: 4px 10px;\n  background: ${(props) =>\n    props.$selected ? props.$theme.bgSelected : 'transparent'};\n  color: ${(props) =>\n    props.$selected ? props.$theme.textSelected : props.$theme.textPrimary};\n  svg {\n    fill: ${(props) =>\n      props.$selected ? props.$theme.iconSelected : props.$theme.iconPrimary};\n    margin-top: 2px;\n  }\n  .inner {\n    flex: 1;\n    > div {\n      padding: 0px;\n      flex: 1;\n      display: flex;\n      margin-left: ${(props) => props.$depth * 10}px;\n      align-items: center;\n      div.layer-name {\n        flex: 1;\n        h2 {\n          font-size: 15px;\n          line-height: 26px;\n        }\n      }\n    }\n  }\n`;\n\nconst Expand = styled.a<{ $expanded: boolean }>`\n  width: 8px;\n  height: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transform-origin: center;\n  transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);\n  transform: rotate(${(props) => (props.$expanded ? 180 : 0)}deg);\n  opacity: 0.7;\n  cursor: pointer;\n`;\n\nconst Hide = styled.a<{\n  $selected: boolean;\n  $isHidden: boolean;\n  $theme: LayersTheme;\n}>`\n  width: 14px;\n  height: 14px;\n  margin-right: 10px;\n  position: relative;\n  transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);\n  cursor: pointer;\n\n  svg {\n    width: 100%;\n    height: 100%;\n    object-fit: contain;\n    opacity: ${(props) => (props.$isHidden ? 0.2 : 1)};\n  }\n  &:after {\n    content: ' ';\n    width: 2px;\n    height: ${(props) => (props.$isHidden ? 100 : 0)}%;\n    position: absolute;\n    left: 2px;\n    top: 3px;\n    background: ${(props) =>\n      props.$selected ? props.$theme.iconSelected : props.$theme.iconPrimary};\n    transform: rotate(-45deg);\n    transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);\n    transform-origin: 0% 0%;\n    opacity: ${(props) => (props.$isHidden ? 0.4 : 1)};\n  }\n`;\n\nconst TopLevelIndicator = styled.div`\n  margin-left: -22px;\n  margin-right: 10px;\n\n  svg {\n    width: 12px;\n    height: 12px;\n  }\n`;\n\nexport const DefaultLayerHeader = () => {\n  const theme = useLayerTheme();\n  const {\n    id,\n    depth,\n    expanded,\n    children,\n    connectors: { drag, layerHeader },\n    actions: { toggleLayer },\n  } = useLayer((layer) => {\n    return {\n      expanded: layer.expanded,\n    };\n  });\n\n  const { hidden, actions, selected, topLevel } = useEditor((state, query) => {\n    // TODO: handle multiple selected elements\n    const selected = query.getEvent('selected').first() === id;\n\n    return {\n      hidden: state.nodes[id] && state.nodes[id].data.hidden,\n      selected,\n      topLevel: query.node(id).isTopLevelCanvas(),\n    };\n  });\n\n  return (\n    <StyledDiv\n      $selected={selected}\n      ref={(dom) => {\n        drag(dom);\n      }}\n      $depth={depth}\n      $theme={theme}\n    >\n      <Hide\n        $selected={selected}\n        $isHidden={hidden}\n        $theme={theme}\n        onClick={() => actions.setHidden(id, !hidden)}\n      >\n        <Eye />\n      </Hide>\n      <div className=\"inner\">\n        <div\n          ref={(dom) => {\n            layerHeader(dom);\n          }}\n        >\n          {topLevel ? (\n            <TopLevelIndicator>\n              <Linked />\n            </TopLevelIndicator>\n          ) : null}\n\n          <div className=\"layer-name s\">\n            <EditableLayerName />\n          </div>\n          <div>\n            {children && children.length ? (\n              <Expand $expanded={expanded} onMouseDown={() => toggleLayer()}>\n                <Arrow />\n              </Expand>\n            ) : null}\n          </div>\n        </div>\n      </div>\n    </StyledDiv>\n  );\n};\n","import { useEditor } from '@craftjs/core';\nimport React from 'react';\nimport { styled } from 'styled-components';\n\nimport { DefaultLayerHeader } from './DefaultLayerHeader';\n\nimport { LayersTheme } from '../../theme';\nimport { useLayerTheme } from '../ThemeContext';\nimport { useLayer } from '../useLayer';\n\nconst LayerNodeDiv = styled.div<{\n  $expanded: boolean;\n  $hasCanvases: boolean;\n  $hovered: boolean;\n  $theme: LayersTheme;\n}>`\n  background: ${(props) =>\n    props.$hovered ? props.$theme.bgHover : props.$theme.bgBase};\n  display: block;\n  padding-bottom: ${(props) =>\n    props.$hasCanvases && props.$expanded ? 5 : 0}px;\n`;\n\nconst LayerChildren = styled.div<{\n  $hasCanvases: boolean;\n  $theme: LayersTheme;\n}>`\n  margin: 0 0 0 ${(props) => (props.$hasCanvases ? 35 : 0)}px;\n  background: ${(props) =>\n    props.$hasCanvases ? props.$theme.bgCanvas : 'transparent'};\n  position: relative;\n\n  ${(props) =>\n    props.$hasCanvases\n      ? `\n\n  box-shadow: 0px 0px 44px -1px ${props.$theme.shadowColor};\n  border-radius: 10px;\n  margin-right: 5px;\n  margin-bottom:5px;\n  margin-top:5px;\n  > * { overflow:hidden; }\n    &:before {\n      position:absolute;\n      left:-19px;\n      width: 2px;\n      height:100%;\n      content: \" \";\n      background:${props.$theme.borderColor};\n    }\n  `\n      : ''}\n`;\n\nexport type DefaultLayerProps = {\n  children?: React.ReactNode;\n};\n\nexport const DefaultLayer = ({ children }: DefaultLayerProps) => {\n  const theme = useLayerTheme();\n  const {\n    id,\n    expanded,\n    hovered,\n    connectors: { layer },\n  } = useLayer((layer) => ({\n    hovered: layer.event.hovered,\n    expanded: layer.expanded,\n  }));\n  const { hasChildCanvases } = useEditor((state, query) => {\n    return {\n      hasChildCanvases: query.node(id).isParentOfTopLevelNodes(),\n    };\n  });\n\n  return (\n    <LayerNodeDiv\n      ref={(dom) => {\n        layer(dom);\n      }}\n      $expanded={expanded}\n      $hasCanvases={hasChildCanvases}\n      $hovered={hovered}\n      $theme={theme}\n    >\n      <DefaultLayerHeader />\n      {children ? (\n        <LayerChildren\n          $hasCanvases={hasChildCanvases}\n          $theme={theme}\n          className=\"craft-layer-children\"\n        >\n          {children}\n        </LayerChildren>\n      ) : null}\n    </LayerNodeDiv>\n  );\n};\n","import { useMethods } from '@craftjs/utils';\nimport React from 'react';\n\nimport { LayerMethods } from './actions';\nimport { LayerManagerContext, LayerStore } from './context';\n\nimport { LayerEventContextProvider } from '../events';\nimport { LayerOptions } from '../interfaces';\nimport { DefaultLayer } from '../layers';\nimport { ThemeProvider } from '../layers/ThemeContext';\n\ntype LayerManagerProviderProps = {\n  options: Partial<LayerOptions>;\n  children?: React.ReactNode;\n};\n\nexport const LayerManagerProvider = ({\n  children,\n  options,\n}: LayerManagerProviderProps) => {\n  // TODO: fix type\n  const store = useMethods(LayerMethods, {\n    layers: {},\n    events: {\n      selected: null,\n      dragged: null,\n      hovered: null,\n    },\n    options: {\n      renderLayer: DefaultLayer,\n      ...options,\n    },\n  }) as LayerStore;\n\n  return (\n    <LayerManagerContext.Provider value={{ store }}>\n      <ThemeProvider theme={options.theme} themeMode={options.themeMode}>\n        <LayerEventContextProvider>{children}</LayerEventContextProvider>\n      </ThemeProvider>\n    </LayerManagerContext.Provider>\n  );\n};\n","import { ROOT_NODE } from '@craftjs/utils';\nimport React from 'react';\n\nimport { LayerOptions } from './interfaces';\nimport { LayerContextProvider } from './layers/LayerContextProvider';\nimport { LayerManagerProvider } from './manager/LayerManagerProvider';\n\nexport {\n  useLayer,\n  DefaultLayer,\n  DefaultLayerHeader,\n  EditableLayerName,\n} from './layers';\n\nexport type { LayersTheme } from './theme';\nexport { lightTheme, darkTheme, getTheme } from './theme';\n\ntype LayersProps = Partial<LayerOptions>;\n\nexport const Layers = ({ ...options }: LayersProps) => {\n  return (\n    <LayerManagerProvider options={options}>\n      <LayerContextProvider id={ROOT_NODE} depth={0} />\n    </LayerManagerProvider>\n  );\n};\n"],"names":["LayerContext","React","createContext","LayerManagerContext","useLayerManager","collector","store","useContext","collected","useCollector","useMemo","useLayer","collect","id","depth","connectors","internalConnectors","actions","managerActions","state","layers","children","useEditor","query","nodes","node","descendants","toggleLayer","setExpandedState","expanded","wrapConnectorHooks","layer","el","drag","layerHeader","LayerNode","data","shouldBeExpanded","selected","getEvent","first","ancestors","includes","registerLayer","renderLayer","expandRootOnLoad","options","isRegistered","setRegistered","useState","useLayoutEffect","expandedRef","useRef","current","shouldBeExpandedOnLoad","ROOT_NODE","useEffect","createElement","className","map","LayerContextProvider","key","LayerEventHandlerContext","handlers","connectorsUsage","createConnectorsUsage","register","cleanup","exists","Provider","value","LayerMethods","setLayerEvent","eventType","events","event","dom","headingDom","hovered","setDOM","domCollection","setIndicator","indicator","LayerHandlers","DerivedCoreEventHandlers","getLayer","this","layerStore","getState","editorStore","derived","layerId","cleanupParentConnectors","inherit","select","hover","unbindMouseOver","addCraftEventListener","e","craft","stopPropagation","unbindMouseleave","removeHoverOnMouseleave","unbindDragOver","preventDefault","currentCanvasHovered","heading","getBoundingClientRect","clientY","top","bottom","currNode","length","_objectSpread","placement","index","where","parent","onCanvas","currentNode","get","unbindDragEnter","dragId","draggedElement","indicatorInfo","getDropPlaceholder","x","clientX","y","parentHeadingInfo","isCanvas","grandparent","indexOf","setAttribute","unbindDragStart","unbindDragEnd","error","parentId","move","removeAttribute","_defineProperty","RenderLayerIndicator","enabled","indicatorStyles","getOptions","indicatorPosition","color","success","parentPos","parentHeadingPos","left","width","height","background","borderWidth","borderColor","headingPos","pos","RenderIndicator","style","LayerEventContextProvider","coreEventHandler","useEventHandler","handler","derive","EditableLayerName","displayName","custom","hidden","editingName","setEditingName","nameDOM","clickOutside","useCallback","contains","target","window","removeEventListener","ContentEditable","html","disabled","ref","addEventListener","onChange","setCustom","tagName","onDoubleClick","_path","_extends","Object","assign","bind","n","arguments","t","r","hasOwnProperty","call","apply","_path2","SvgArrow","props","xmlns","viewBox","d","SvgEye","fill","SvgLinked","lightTheme","bgBase","bgHover","bgSelected","bgCanvas","textPrimary","textSelected","iconPrimary","iconSelected","shadowColor","darkTheme","getTheme","mode","ThemeContext","ThemeProvider","theme","themeMode","useLayerTheme","context","StyledDiv","styled","div","$selected","$theme","$depth","Expand","a","$expanded","Hide","$isHidden","TopLevelIndicator","DefaultLayerHeader","topLevel","isTopLevelCanvas","onClick","setHidden","Eye","Linked","onMouseDown","Arrow","LayerNodeDiv","$hovered","$hasCanvases","LayerChildren","DefaultLayer","hasChildCanvases","isParentOfTopLevelNodes","LayerManagerProvider","useMethods","dragged"],"mappings":"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"}