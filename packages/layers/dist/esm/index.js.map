{"version":3,"file":"index.js","sources":["../../src/layers/LayerContext.tsx","../../src/manager/context.tsx","../../src/manager/useLayerManager.tsx","../../src/layers/useLayer.tsx","../../src/layers/LayerNode.tsx","../../src/events/LayerEventContext.tsx","../../src/layers/LayerContextProvider.tsx","../../src/manager/actions.tsx","../../src/events/LayerHandlers.ts","../../src/events/RenderLayerIndicator.tsx","../../src/events/LayerEventContextProvider.tsx","../../src/layers/DefaultLayer/EditableLayerName.tsx","../../src/layers/DefaultLayer/svg/arrow.svg","../../src/layers/DefaultLayer/svg/eye.svg","../../src/layers/DefaultLayer/svg/linked.svg","../../src/theme.ts","../../src/layers/ThemeContext.tsx","../../src/layers/DefaultLayer/DefaultLayerHeader.tsx","../../src/layers/DefaultLayer/DefaultLayer.tsx","../../src/manager/LayerManagerProvider.tsx","../../src/index.tsx"],"sourcesContent":["import { NodeId } from '@craftjs/core';\nimport { EventHandlerConnectors } from '@craftjs/utils';\nimport React from 'react';\n\nimport { LayerHandlers } from '../events/LayerHandlers';\n\nexport type LayerContextType = {\n  id: NodeId;\n  depth: number;\n  connectors: EventHandlerConnectors<LayerHandlers, React.ReactElement>;\n};\n\nexport const LayerContext = React.createContext<LayerContextType>(\n  {} as LayerContextType\n);\n","import { SubscriberAndCallbacksFor } from '@craftjs/utils';\nimport { createContext } from 'react';\n\nimport { LayerMethods } from './actions';\n\nexport type LayerStore = SubscriberAndCallbacksFor<typeof LayerMethods>;\nexport type LayerManagerContextType = {\n  store: LayerStore;\n};\n\nexport const LayerManagerContext = createContext<LayerManagerContextType>(\n  {} as LayerManagerContextType\n);\n","import { useCollector } from '@craftjs/utils';\nimport { useContext, useMemo } from 'react';\n\nimport { LayerManagerContext } from './context';\n\nimport { LayerState } from '../interfaces';\n\nexport function useLayerManager<C>(collector?: (state: LayerState) => C) {\n  const { store } = useContext(LayerManagerContext);\n  const collected = useCollector(store, collector);\n\n  return useMemo(\n    () => ({\n      store,\n      ...collected,\n    }),\n    [store, collected]\n  );\n}\n","import { useEditor } from '@craftjs/core';\nimport { wrapConnectorHooks } from '@craftjs/utils';\nimport { useContext, useMemo } from 'react';\n\nimport { LayerContext } from './LayerContext';\n\nimport { Layer } from '../interfaces';\nimport { useLayerManager } from '../manager';\n\nexport function useLayer<S = null>(collect?: (layer: Layer) => S) {\n  const { id, depth, connectors: internalConnectors } = useContext(\n    LayerContext\n  );\n\n  const { actions: managerActions, ...collected } = useLayerManager((state) => {\n    return id && state.layers[id] && collect && collect(state.layers[id]);\n  });\n\n  const { children } = useEditor((state, query) => ({\n    children: state.nodes[id] && query.node(id).descendants(),\n  }));\n\n  const actions = useMemo(() => {\n    return {\n      toggleLayer: () => managerActions.toggleLayer(id),\n      setExpandedState: (expanded: boolean) =>\n        managerActions.setExpandedState(id, expanded),\n    };\n  }, [managerActions, id]);\n\n  const connectors = useMemo(\n    () =>\n      wrapConnectorHooks({\n        layer: (el: HTMLElement) => internalConnectors.layer(el, id),\n        drag: (el: HTMLElement) => internalConnectors.drag(el, id),\n        layerHeader: (el: HTMLElement) =>\n          internalConnectors.layerHeader(el, id),\n      }),\n    [internalConnectors, id]\n  );\n\n  return {\n    id,\n    depth,\n    children,\n    actions,\n    connectors,\n    ...collected,\n  };\n}\n","import { useEditor, ROOT_NODE } from '@craftjs/core';\nimport React, { useRef, useEffect, useLayoutEffect, useState } from 'react';\n\nimport { LayerContextProvider } from './LayerContextProvider';\nimport { useLayer } from './useLayer';\n\nimport { useLayerManager } from '../manager/useLayerManager';\n\nexport const LayerNode = () => {\n  const { id, depth, children, expanded } = useLayer((layer) => ({\n    expanded: layer.expanded,\n  }));\n\n  const { data, shouldBeExpanded } = useEditor((state, query) => {\n    // TODO: handle multiple selected elements\n    const selected = query.getEvent('selected').first();\n\n    return {\n      data: state.nodes[id] && state.nodes[id].data,\n      shouldBeExpanded:\n        selected && query.node(selected).ancestors(true).includes(id),\n    };\n  });\n\n  const {\n    actions: { registerLayer, toggleLayer },\n    renderLayer,\n    expandRootOnLoad,\n  } = useLayerManager((state) => ({\n    renderLayer: state.options.renderLayer,\n    expandRootOnLoad: state.options.expandRootOnLoad,\n  }));\n\n  const [isRegistered, setRegistered] = useState(false);\n\n  useLayoutEffect(() => {\n    registerLayer(id);\n    setRegistered(true);\n  }, [registerLayer, id]);\n\n  const expandedRef = useRef<boolean>(expanded);\n  expandedRef.current = expanded;\n\n  const shouldBeExpandedOnLoad = useRef<boolean>(\n    expandRootOnLoad && id === ROOT_NODE\n  );\n\n  useEffect(() => {\n    if (!expandedRef.current && shouldBeExpanded) {\n      toggleLayer(id);\n    }\n  }, [toggleLayer, id, shouldBeExpanded]);\n\n  useEffect(() => {\n    if (shouldBeExpandedOnLoad.current) {\n      toggleLayer(id);\n    }\n  }, [toggleLayer, id]);\n\n  return data && isRegistered ? (\n    <div className={`craft-layer-node ${id}`}>\n      {React.createElement(\n        renderLayer,\n        {},\n        children && expanded\n          ? children.map((id) => (\n              <LayerContextProvider key={id} id={id} depth={depth + 1} />\n            ))\n          : null\n      )}\n    </div>\n  ) : null;\n};\n","import { createContext, useContext } from 'react';\n\nimport { LayerHandlers } from './LayerHandlers';\n\nexport const LayerEventHandlerContext = createContext<LayerHandlers>(null);\n\nexport const useLayerEventHandler = () => useContext(LayerEventHandlerContext);\n","import { useEditor } from '@craftjs/core';\nimport { wrapConnectorHooks } from '@craftjs/utils';\nimport React, { useMemo, useContext, useRef, useEffect } from 'react';\n\nimport { LayerContext, LayerContextType } from './LayerContext';\nimport { LayerNode } from './LayerNode';\n\nimport { useLayerEventHandler } from '../events/LayerEventContext';\nimport { LayerManagerContext } from '../manager';\n\nexport type LayerContextProviderProps = Omit<LayerContextType, 'connectors'>;\n\nexport const LayerContextProvider = ({\n  id,\n  depth,\n}: LayerContextProviderProps) => {\n  const handlers = useLayerEventHandler();\n\n  const { store } = useContext(LayerManagerContext);\n  const storeRef = useRef(store);\n  storeRef.current = store;\n\n  const connectorsUsage = useMemo(() => handlers.createConnectorsUsage(), [\n    handlers,\n  ]);\n\n  const connectors = useMemo(\n    () => wrapConnectorHooks(connectorsUsage.connectors),\n    [connectorsUsage]\n  );\n\n  useEffect(() => {\n    connectorsUsage.register();\n\n    return () => {\n      connectorsUsage.cleanup();\n    };\n  }, [connectorsUsage]);\n\n  const { exists } = useEditor((state) => ({\n    exists: !!state.nodes[id],\n  }));\n\n  if (!exists) {\n    return null;\n  }\n\n  return (\n    <LayerContext.Provider value={{ id, depth, connectors }}>\n      <LayerNode />\n    </LayerContext.Provider>\n  );\n};\n","import { LayerState, LayerEvents } from '../interfaces';\n\nexport const LayerMethods = (state: LayerState) => ({\n  setLayerEvent: (eventType: LayerEvents, id: string) => {\n    if (id !== null && !state.layers[id]) return;\n\n    const current = state.events[eventType];\n    if (current && id !== current) {\n      state.layers[current].event[eventType] = false;\n    }\n\n    if (id) {\n      state.layers[id].event[eventType] = true;\n      state.events[eventType] = id;\n    } else {\n      state.events[eventType] = null;\n    }\n  },\n  registerLayer: (id: string) => {\n    if (!state.layers[id]) {\n      state.layers[id] = {\n        dom: null,\n        headingDom: null,\n        expanded: false,\n        id,\n        event: {\n          selected: false,\n          hovered: false,\n        },\n      };\n    }\n  },\n  setDOM: (\n    id: string,\n    domCollection: Partial<Record<'dom' | 'headingDom', HTMLElement>>\n  ) => {\n    state.layers[id] = {\n      ...state.layers[id],\n      ...(domCollection.dom ? { dom: domCollection.dom } : {}),\n      ...(domCollection.headingDom\n        ? { headingDom: domCollection.headingDom }\n        : {}),\n    };\n  },\n  toggleLayer: (id: string) => {\n    state.layers[id].expanded = !state.layers[id].expanded;\n  },\n  setExpandedState: (id: string, expanded: boolean) => {\n    state.layers[id].expanded = expanded;\n  },\n  setIndicator: (indicator) => {\n    state.events.indicator = indicator;\n  },\n});\n","import { NodeId, Node, DerivedCoreEventHandlers } from '@craftjs/core';\n\nimport { LayerIndicator } from '../interfaces';\n\nexport class LayerHandlers extends DerivedCoreEventHandlers<{\n  layerStore: any;\n}> {\n  static draggedElement;\n  static events: {\n    indicator: LayerIndicator;\n    currentCanvasHovered: Node;\n  } = {\n    indicator: null,\n    currentCanvasHovered: null,\n  };\n\n  getLayer(id: NodeId) {\n    return this.options.layerStore.getState().layers[id];\n  }\n\n  handlers() {\n    const editorStore = this.derived.options.store;\n    const { layerStore } = this.options;\n    return {\n      layer: (el: HTMLElement, layerId: NodeId) => {\n        layerStore.actions.setDOM(layerId, {\n          dom: el,\n        });\n\n        const cleanupParentConnectors = this.inherit((connectors) => {\n          connectors.select(el, layerId);\n          connectors.hover(el, layerId);\n          connectors.drag(el, layerId);\n        });\n\n        const unbindMouseOver = this.addCraftEventListener(\n          el,\n          'mouseover',\n          (e) => {\n            e.craft.stopPropagation();\n            layerStore.actions.setLayerEvent('hovered', layerId);\n          }\n        );\n\n        let unbindMouseleave: (() => void) | null = null;\n\n        if (this.derived.options.removeHoverOnMouseleave) {\n          unbindMouseleave = this.addCraftEventListener(\n            el,\n            'mouseleave',\n            (e) => {\n              e.craft.stopPropagation();\n              layerStore.actions.setLayerEvent('hovered', null);\n            }\n          );\n        }\n\n        const unbindDragOver = this.addCraftEventListener(\n          el,\n          'dragover',\n          (e) => {\n            e.craft.stopPropagation();\n            e.preventDefault();\n\n            const { indicator, currentCanvasHovered } = LayerHandlers.events;\n\n            if (currentCanvasHovered && indicator) {\n              const heading = this.getLayer(\n                currentCanvasHovered.id\n              ).headingDom.getBoundingClientRect();\n\n              if (\n                e.clientY > heading.top + 10 &&\n                e.clientY < heading.bottom - 10\n              ) {\n                const currNode =\n                  currentCanvasHovered.data.nodes[\n                    currentCanvasHovered.data.nodes.length - 1\n                  ];\n\n                if (!currNode) {\n                  // If the currentCanvasHovered has no child nodes, then we place the indicator as the first child\n                  LayerHandlers.events.indicator = {\n                    ...indicator,\n                    placement: {\n                      ...indicator.placement,\n                      index: 0,\n                      where: 'before',\n                      parent: currentCanvasHovered,\n                    },\n                    onCanvas: true,\n                  };\n                  return;\n                }\n\n                LayerHandlers.events.indicator = {\n                  ...indicator,\n                  placement: {\n                    currentNode: editorStore.query.node(currNode).get(),\n                    index: currentCanvasHovered.data.nodes.length,\n                    where: 'after',\n                    parent: currentCanvasHovered,\n                  },\n                  onCanvas: true,\n                };\n\n                layerStore.actions.setIndicator(LayerHandlers.events.indicator);\n              }\n            }\n          }\n        );\n\n        const unbindDragEnter = this.addCraftEventListener(\n          el,\n          'dragenter',\n          (e) => {\n            e.craft.stopPropagation();\n            e.preventDefault();\n\n            const dragId = LayerHandlers.draggedElement;\n\n            if (!dragId) return;\n\n            let target = layerId;\n\n            const indicatorInfo = editorStore.query.getDropPlaceholder(\n              dragId,\n              target,\n              { x: e.clientX, y: e.clientY },\n              (node) => {\n                const layer = this.getLayer(node.id);\n                return layer && layer.dom;\n              }\n            );\n\n            if (indicatorInfo) {\n              const {\n                placement: { parent },\n              } = indicatorInfo;\n              const parentHeadingInfo = this.getLayer(\n                parent.id\n              ).headingDom.getBoundingClientRect();\n\n              LayerHandlers.events.currentCanvasHovered = null;\n              if (editorStore.query.node(parent.id).isCanvas()) {\n                if (parent.data.parent) {\n                  const grandparent = editorStore.query\n                    .node(parent.data.parent)\n                    .get();\n                  if (editorStore.query.node(grandparent.id).isCanvas()) {\n                    LayerHandlers.events.currentCanvasHovered = parent;\n                    if (\n                      (e.clientY > parentHeadingInfo.bottom - 10 &&\n                        !this.getLayer(parent.id).expanded) ||\n                      e.clientY < parentHeadingInfo.top + 10\n                    ) {\n                      indicatorInfo.placement.parent = grandparent;\n                      indicatorInfo.placement.currentNode = parent;\n                      indicatorInfo.placement.index = grandparent.data.nodes\n                        ? grandparent.data.nodes.indexOf(parent.id)\n                        : 0;\n                      if (\n                        e.clientY > parentHeadingInfo.bottom - 10 &&\n                        !this.getLayer(parent.id).expanded\n                      ) {\n                        indicatorInfo.placement.where = 'after';\n                      } else if (e.clientY < parentHeadingInfo.top + 10) {\n                        indicatorInfo.placement.where = 'before';\n                      }\n                    }\n                  }\n                }\n              }\n\n              LayerHandlers.events.indicator = {\n                ...indicatorInfo,\n                onCanvas: false,\n              };\n\n              layerStore.actions.setIndicator(LayerHandlers.events.indicator);\n            }\n          }\n        );\n\n        return () => {\n          cleanupParentConnectors();\n          unbindMouseOver();\n          unbindDragOver();\n          unbindDragEnter();\n\n          if (!unbindMouseleave) {\n            return;\n          }\n\n          unbindMouseleave();\n        };\n      },\n      layerHeader: (el: HTMLElement, layerId: NodeId) => {\n        layerStore.actions.setDOM(layerId, {\n          headingDom: el,\n        });\n      },\n      drag: (el: HTMLElement, layerId: NodeId) => {\n        el.setAttribute('draggable', 'true');\n\n        const unbindDragStart = this.addCraftEventListener(\n          el,\n          'dragstart',\n          (e) => {\n            e.craft.stopPropagation();\n            LayerHandlers.draggedElement = layerId;\n          }\n        );\n\n        const unbindDragEnd = this.addCraftEventListener(el, 'dragend', (e) => {\n          e.craft.stopPropagation();\n          const events = LayerHandlers.events;\n\n          if (events.indicator && !events.indicator.error) {\n            const { placement } = events.indicator;\n            const { parent, index, where } = placement;\n            const { id: parentId } = parent;\n\n            editorStore.actions.move(\n              LayerHandlers.draggedElement as NodeId,\n              parentId,\n              index + (where === 'after' ? 1 : 0)\n            );\n          }\n\n          LayerHandlers.draggedElement = null;\n          LayerHandlers.events.indicator = null;\n          layerStore.actions.setIndicator(null);\n        });\n\n        return () => {\n          el.removeAttribute('draggable');\n          unbindDragStart();\n          unbindDragEnd();\n        };\n      },\n    };\n  }\n}\n","import { useEditor } from '@craftjs/core';\nimport { RenderIndicator } from '@craftjs/utils';\nimport React, { useMemo } from 'react';\n\nimport { useLayerManager } from '../manager/useLayerManager';\n\ntype RenderLayerIndicatorProps = {\n  children?: React.ReactNode;\n};\n\nexport const RenderLayerIndicator = ({\n  children,\n}: RenderLayerIndicatorProps) => {\n  const { layers, events } = useLayerManager((state) => state);\n  const { query } = useEditor((state) => ({ enabled: state.options.enabled }));\n  const { indicator: indicatorStyles } = query.getOptions();\n\n  const indicatorPosition = useMemo(() => {\n    const { indicator } = events;\n\n    if (indicator) {\n      const {\n        placement: { where, parent, currentNode },\n        error,\n      } = indicator;\n      const layerId = currentNode ? currentNode.id : parent.id;\n\n      let top;\n      const color = error ? indicatorStyles.error : indicatorStyles.success;\n\n      if (indicator.onCanvas && layers[parent.id].dom != null) {\n        const parentPos = layers[parent.id].dom.getBoundingClientRect();\n        const parentHeadingPos = layers[\n          parent.id\n        ].headingDom.getBoundingClientRect();\n        return {\n          top: parentHeadingPos.top,\n          left: parentPos.left,\n          width: parentPos.width,\n          height: parentHeadingPos.height,\n          background: 'transparent',\n          borderWidth: '1px',\n          borderColor: color,\n        };\n      } else {\n        if (!layers[layerId]) return;\n        const headingPos = layers[layerId].headingDom.getBoundingClientRect();\n        const pos = layers[layerId].dom.getBoundingClientRect();\n\n        if (where === 'after' || !currentNode) {\n          top = pos.top + pos.height;\n        } else {\n          top = pos.top;\n        }\n\n        return {\n          top,\n          left: headingPos.left,\n          width: pos.width + pos.left - headingPos.left,\n          height: 2,\n          borderWidth: 0,\n          background: color,\n        };\n      }\n    }\n  }, [events, indicatorStyles.error, indicatorStyles.success, layers]);\n\n  return (\n    <div>\n      {events.indicator\n        ? React.createElement(RenderIndicator, {\n            style: indicatorPosition,\n          })\n        : null}\n      {children}\n    </div>\n  );\n};\n","import { useEventHandler } from '@craftjs/core';\nimport React, { useMemo } from 'react';\n\nimport { LayerEventHandlerContext } from './LayerEventContext';\nimport { LayerHandlers } from './LayerHandlers';\nimport { RenderLayerIndicator } from './RenderLayerIndicator';\n\nimport { useLayerManager } from '../manager';\n\nexport const LayerEventContextProvider = ({ children }) => {\n  const { store: layerStore } = useLayerManager();\n  const coreEventHandler = useEventHandler();\n\n  const handler = useMemo(\n    () =>\n      coreEventHandler.derive(LayerHandlers, {\n        layerStore,\n      }),\n    [coreEventHandler, layerStore]\n  );\n\n  return (\n    <LayerEventHandlerContext.Provider value={handler}>\n      <RenderLayerIndicator />\n      {children}\n    </LayerEventHandlerContext.Provider>\n  );\n};\n","import { useEditor } from '@craftjs/core';\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport ContentEditable from 'react-contenteditable';\n\nimport { useLayer } from '../useLayer';\n\nexport const EditableLayerName = () => {\n  const { id } = useLayer();\n\n  const { displayName, actions } = useEditor((state) => ({\n    displayName:\n      state.nodes[id] && state.nodes[id].data.custom.displayName\n        ? state.nodes[id].data.custom.displayName\n        : state.nodes[id].data.displayName,\n    hidden: state.nodes[id] && state.nodes[id].data.hidden,\n  }));\n\n  const [editingName, setEditingName] = useState(false);\n  const nameDOM = useRef<HTMLElement | null>(null);\n\n  const clickOutside = useCallback((e) => {\n    if (nameDOM.current && !nameDOM.current.contains(e.target)) {\n      setEditingName(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    return () => {\n      window.removeEventListener('click', clickOutside);\n    };\n  }, [clickOutside]);\n\n  return (\n    <ContentEditable\n      html={displayName}\n      disabled={!editingName}\n      ref={(ref: any) => {\n        if (ref) {\n          nameDOM.current = ref.el.current;\n          window.removeEventListener('click', clickOutside);\n          window.addEventListener('click', clickOutside);\n        }\n      }}\n      onChange={(e) => {\n        actions.setCustom(\n          id,\n          (custom) => (custom.displayName = e.target.value)\n        );\n      }}\n      tagName=\"h2\"\n      onDoubleClick={() => {\n        if (!editingName) setEditingName(true);\n      }}\n    />\n  );\n};\n","<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 10 6\">\n  <title>ChevronDownMedium</title>\n  <rect id=\"ToDelete\" fill=\"#ff13dc\" opacity=\"0\" /><path d=\"M9.99,1.01A.9999.9999,0,0,0,8.28266.30327L5,3.58594,1.71734.30327A.9999.9999,0,1,0,.30327,1.71734L4.29266,5.69673a.99965.99965,0,0,0,1.41468,0L9.69673,1.71734A.99669.99669,0,0,0,9.99,1.01Z\" />\n</svg>","<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\"><path fill=\"none\" d=\"M0 0h24v24H0z\"/><path d=\"M1.181 12C2.121 6.88 6.608 3 12 3c5.392 0 9.878 3.88 10.819 9-.94 5.12-5.427 9-10.819 9-5.392 0-9.878-3.88-10.819-9zM12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0-2a3 3 0 1 1 0-6 3 3 0 0 1 0 6z\"/></svg>","<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 18 18\">\n  <defs>\n    <!-- <style>\n      .a {\n        fill: #707070;\n      }\n    </style> -->\n  </defs>\n  <title>S LinkOut 18 N</title>\n  <rect id=\"Canvas\" opacity=\"0\" /><path class=\"a\" d=\"M16.5,9h-1a.5.5,0,0,0-.5.5V15H3V3H8.5A.5.5,0,0,0,9,2.5v-1A.5.5,0,0,0,8.5,1h-7a.5.5,0,0,0-.5.5v15a.5.5,0,0,0,.5.5h15a.5.5,0,0,0,.5-.5v-7A.5.5,0,0,0,16.5,9Z\" />\n  <path class=\"a\" d=\"M16.75,1H11.377A.4.4,0,0,0,11,1.4a.392.392,0,0,0,.1175.28l1.893,1.895L9.4895,7.096a.5.5,0,0,0-.00039.70711l.00039.00039.707.707a.5.5,0,0,0,.707,0l3.5215-3.521L16.318,6.882A.39051.39051,0,0,0,16.6,7a.4.4,0,0,0,.4-.377V1.25A.25.25,0,0,0,16.75,1Z\" />\n</svg>","// Theme configuration for Craft.js Layers\nexport interface LayersTheme {\n  // Background colors\n  bgBase: string;\n  bgHover: string;\n  bgSelected: string;\n  bgCanvas: string;\n\n  // Text colors\n  textPrimary: string;\n  textSelected: string;\n\n  // Icon colors\n  iconPrimary: string;\n  iconSelected: string;\n\n  // Border and shadow\n  borderColor: string;\n  shadowColor: string;\n}\n\n// Light theme (default)\nexport const lightTheme: LayersTheme = {\n  bgBase: 'transparent',\n  bgHover: '#f1f1f1',\n  bgSelected: '#2680eb',\n  bgCanvas: 'rgba(255, 255, 255, 0.02)',\n\n  textPrimary: 'inherit',\n  textSelected: '#fff',\n\n  iconPrimary: '#808184',\n  iconSelected: '#fff',\n\n  borderColor: '#00000012',\n  shadowColor: '#00000014',\n};\n\n// Dark theme\nexport const darkTheme: LayersTheme = {\n  bgBase: 'transparent',\n  bgHover: '#2a2a2a',\n  bgSelected: '#2680eb',\n  bgCanvas: 'rgba(255, 255, 255, 0.05)',\n\n  textPrimary: '#e0e0e0',\n  textSelected: '#fff',\n\n  iconPrimary: '#b0b0b0',\n  iconSelected: '#fff',\n\n  borderColor: '#ffffff12',\n  shadowColor: '#00000040',\n};\n\n// Theme helper function\nexport const getTheme = (mode?: 'light' | 'dark'): LayersTheme => {\n  return mode === 'dark' ? darkTheme : lightTheme;\n};\n","import React, { createContext, useContext, useMemo } from 'react';\n\nimport { LayersTheme, getTheme } from '../theme';\n\ninterface ThemeContextValue {\n  theme: LayersTheme;\n}\n\nconst ThemeContext = createContext<ThemeContextValue | null>(null);\n\nexport interface ThemeProviderProps {\n  theme?: LayersTheme;\n  themeMode?: 'light' | 'dark';\n  children: React.ReactNode;\n}\n\nexport const ThemeProvider = ({\n  theme,\n  themeMode,\n  children,\n}: ThemeProviderProps) => {\n  const value = useMemo<ThemeContextValue>(() => {\n    // Use custom theme if provided, otherwise use themeMode\n    const resolvedTheme = theme || getTheme(themeMode);\n    return { theme: resolvedTheme };\n  }, [theme, themeMode]);\n\n  return (\n    <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>\n  );\n};\n\nexport const useLayerTheme = (): LayersTheme => {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    // Return default light theme if no provider\n    return getTheme('light');\n  }\n  return context.theme;\n};\n","import { useEditor } from '@craftjs/core';\nimport React from 'react';\nimport { styled } from 'styled-components';\n\nimport { EditableLayerName } from './EditableLayerName';\nimport Arrow from './svg/arrow.svg';\nimport Eye from './svg/eye.svg';\nimport Linked from './svg/linked.svg';\n\nimport { LayersTheme } from '../../theme';\nimport { useLayerTheme } from '../ThemeContext';\nimport { useLayer } from '../useLayer';\n\nconst StyledDiv = styled.div<{\n  $depth: number;\n  $selected: boolean;\n  $theme: LayersTheme;\n}>`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding: 4px 10px;\n  background: ${(props) =>\n    props.$selected ? props.$theme.bgSelected : 'transparent'};\n  color: ${(props) =>\n    props.$selected ? props.$theme.textSelected : props.$theme.textPrimary};\n  svg {\n    fill: ${(props) =>\n      props.$selected ? props.$theme.iconSelected : props.$theme.iconPrimary};\n    margin-top: 2px;\n  }\n  .inner {\n    flex: 1;\n    > div {\n      padding: 0px;\n      flex: 1;\n      display: flex;\n      margin-left: ${(props) => props.$depth * 10}px;\n      align-items: center;\n      div.layer-name {\n        flex: 1;\n        h2 {\n          font-size: 15px;\n          line-height: 26px;\n        }\n      }\n    }\n  }\n`;\n\nconst Expand = styled.a<{ $expanded: boolean }>`\n  width: 8px;\n  height: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transform-origin: center;\n  transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);\n  transform: rotate(${(props) => (props.$expanded ? 180 : 0)}deg);\n  opacity: 0.7;\n  cursor: pointer;\n`;\n\nconst Hide = styled.a<{\n  $selected: boolean;\n  $isHidden: boolean;\n  $theme: LayersTheme;\n}>`\n  width: 14px;\n  height: 14px;\n  margin-right: 10px;\n  position: relative;\n  transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);\n  cursor: pointer;\n\n  svg {\n    width: 100%;\n    height: 100%;\n    object-fit: contain;\n    opacity: ${(props) => (props.$isHidden ? 0.2 : 1)};\n  }\n  &:after {\n    content: ' ';\n    width: 2px;\n    height: ${(props) => (props.$isHidden ? 100 : 0)}%;\n    position: absolute;\n    left: 2px;\n    top: 3px;\n    background: ${(props) =>\n      props.$selected ? props.$theme.iconSelected : props.$theme.iconPrimary};\n    transform: rotate(-45deg);\n    transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);\n    transform-origin: 0% 0%;\n    opacity: ${(props) => (props.$isHidden ? 0.4 : 1)};\n  }\n`;\n\nconst TopLevelIndicator = styled.div`\n  margin-left: -22px;\n  margin-right: 10px;\n\n  svg {\n    width: 12px;\n    height: 12px;\n  }\n`;\n\nexport const DefaultLayerHeader = () => {\n  const theme = useLayerTheme();\n  const {\n    id,\n    depth,\n    expanded,\n    children,\n    connectors: { drag, layerHeader },\n    actions: { toggleLayer },\n  } = useLayer((layer) => {\n    return {\n      expanded: layer.expanded,\n    };\n  });\n\n  const { hidden, actions, selected, topLevel } = useEditor((state, query) => {\n    // TODO: handle multiple selected elements\n    const selected = query.getEvent('selected').first() === id;\n\n    return {\n      hidden: state.nodes[id] && state.nodes[id].data.hidden,\n      selected,\n      topLevel: query.node(id).isTopLevelCanvas(),\n    };\n  });\n\n  return (\n    <StyledDiv\n      $selected={selected}\n      ref={(dom) => {\n        drag(dom);\n      }}\n      $depth={depth}\n      $theme={theme}\n    >\n      <Hide\n        $selected={selected}\n        $isHidden={hidden}\n        $theme={theme}\n        onClick={() => actions.setHidden(id, !hidden)}\n      >\n        <Eye />\n      </Hide>\n      <div className=\"inner\">\n        <div\n          ref={(dom) => {\n            layerHeader(dom);\n          }}\n        >\n          {topLevel ? (\n            <TopLevelIndicator>\n              <Linked />\n            </TopLevelIndicator>\n          ) : null}\n\n          <div className=\"layer-name s\">\n            <EditableLayerName />\n          </div>\n          <div>\n            {children && children.length ? (\n              <Expand $expanded={expanded} onMouseDown={() => toggleLayer()}>\n                <Arrow />\n              </Expand>\n            ) : null}\n          </div>\n        </div>\n      </div>\n    </StyledDiv>\n  );\n};\n","import { useEditor } from '@craftjs/core';\nimport React from 'react';\nimport { styled } from 'styled-components';\n\nimport { DefaultLayerHeader } from './DefaultLayerHeader';\n\nimport { LayersTheme } from '../../theme';\nimport { useLayerTheme } from '../ThemeContext';\nimport { useLayer } from '../useLayer';\n\nconst LayerNodeDiv = styled.div<{\n  $expanded: boolean;\n  $hasCanvases: boolean;\n  $hovered: boolean;\n  $theme: LayersTheme;\n}>`\n  background: ${(props) =>\n    props.$hovered ? props.$theme.bgHover : props.$theme.bgBase};\n  display: block;\n  padding-bottom: ${(props) =>\n    props.$hasCanvases && props.$expanded ? 5 : 0}px;\n`;\n\nconst LayerChildren = styled.div<{\n  $hasCanvases: boolean;\n  $theme: LayersTheme;\n}>`\n  margin: 0 0 0 ${(props) => (props.$hasCanvases ? 35 : 0)}px;\n  background: ${(props) =>\n    props.$hasCanvases ? props.$theme.bgCanvas : 'transparent'};\n  position: relative;\n\n  ${(props) =>\n    props.$hasCanvases\n      ? `\n\n  box-shadow: 0px 0px 44px -1px ${props.$theme.shadowColor};\n  border-radius: 10px;\n  margin-right: 5px;\n  margin-bottom:5px;\n  margin-top:5px;\n  > * { overflow:hidden; }\n    &:before {\n      position:absolute;\n      left:-19px;\n      width: 2px;\n      height:100%;\n      content: \" \";\n      background:${props.$theme.borderColor};\n    }\n  `\n      : ''}\n`;\n\nexport type DefaultLayerProps = {\n  children?: React.ReactNode;\n};\n\nexport const DefaultLayer = ({ children }: DefaultLayerProps) => {\n  const theme = useLayerTheme();\n  const {\n    id,\n    expanded,\n    hovered,\n    connectors: { layer },\n  } = useLayer((layer) => ({\n    hovered: layer.event.hovered,\n    expanded: layer.expanded,\n  }));\n  const { hasChildCanvases } = useEditor((state, query) => {\n    return {\n      hasChildCanvases: query.node(id).isParentOfTopLevelNodes(),\n    };\n  });\n\n  return (\n    <LayerNodeDiv\n      ref={(dom) => {\n        layer(dom);\n      }}\n      $expanded={expanded}\n      $hasCanvases={hasChildCanvases}\n      $hovered={hovered}\n      $theme={theme}\n    >\n      <DefaultLayerHeader />\n      {children ? (\n        <LayerChildren\n          $hasCanvases={hasChildCanvases}\n          $theme={theme}\n          className=\"craft-layer-children\"\n        >\n          {children}\n        </LayerChildren>\n      ) : null}\n    </LayerNodeDiv>\n  );\n};\n","import { useMethods } from '@craftjs/utils';\nimport React from 'react';\n\nimport { LayerMethods } from './actions';\nimport { LayerManagerContext, LayerStore } from './context';\n\nimport { LayerEventContextProvider } from '../events';\nimport { LayerOptions } from '../interfaces';\nimport { DefaultLayer } from '../layers';\nimport { ThemeProvider } from '../layers/ThemeContext';\n\ntype LayerManagerProviderProps = {\n  options: Partial<LayerOptions>;\n  children?: React.ReactNode;\n};\n\nexport const LayerManagerProvider = ({\n  children,\n  options,\n}: LayerManagerProviderProps) => {\n  // TODO: fix type\n  const store = useMethods(LayerMethods, {\n    layers: {},\n    events: {\n      selected: null,\n      dragged: null,\n      hovered: null,\n    },\n    options: {\n      renderLayer: DefaultLayer,\n      ...options,\n    },\n  }) as LayerStore;\n\n  return (\n    <LayerManagerContext.Provider value={{ store }}>\n      <ThemeProvider theme={options.theme} themeMode={options.themeMode}>\n        <LayerEventContextProvider>{children}</LayerEventContextProvider>\n      </ThemeProvider>\n    </LayerManagerContext.Provider>\n  );\n};\n","import { ROOT_NODE } from '@craftjs/utils';\nimport React from 'react';\n\nimport { LayerOptions } from './interfaces';\nimport { LayerContextProvider } from './layers/LayerContextProvider';\nimport { LayerManagerProvider } from './manager/LayerManagerProvider';\n\nexport {\n  useLayer,\n  DefaultLayer,\n  DefaultLayerHeader,\n  EditableLayerName,\n} from './layers';\n\nexport type { LayersTheme } from './theme';\nexport { lightTheme, darkTheme, getTheme } from './theme';\n\ntype LayersProps = Partial<LayerOptions>;\n\nexport const Layers = ({ ...options }: LayersProps) => {\n  return (\n    <LayerManagerProvider options={options}>\n      <LayerContextProvider id={ROOT_NODE} depth={0} />\n    </LayerManagerProvider>\n  );\n};\n"],"names":["LayerContext","React","createContext","LayerManagerContext","useLayerManager","collector","store","useContext","collected","useCollector","useMemo","useLayer","collect","id","depth","connectors","internalConnectors","actions","managerActions","state","layers","children","useEditor","query","nodes","node","descendants","toggleLayer","setExpandedState","expanded","wrapConnectorHooks","layer","el","drag","layerHeader","LayerNode","data","shouldBeExpanded","selected","getEvent","first","ancestors","includes","registerLayer","renderLayer","expandRootOnLoad","options","isRegistered","setRegistered","useState","useLayoutEffect","expandedRef","useRef","current","shouldBeExpandedOnLoad","ROOT_NODE","useEffect","createElement","className","map","LayerContextProvider","key","LayerEventHandlerContext","handlers","connectorsUsage","createConnectorsUsage","register","cleanup","exists","Provider","value","LayerMethods","setLayerEvent","eventType","events","event","dom","headingDom","hovered","setDOM","domCollection","setIndicator","indicator","LayerHandlers","_DerivedCoreEventHand","_inherits","DerivedCoreEventHandlers","_super","_classCallCheck","this","apply","arguments","layerStore","getState","_this","editorStore","derived","layerId","cleanupParentConnectors","inherit","select","hover","unbindMouseOver","addCraftEventListener","e","craft","stopPropagation","unbindMouseleave","removeHoverOnMouseleave","unbindDragOver","preventDefault","currentCanvasHovered","heading","getLayer","getBoundingClientRect","clientY","top","bottom","currNode","length","placement","_objectSpread","index","where","parent","onCanvas","currentNode","get","unbindDragEnter","dragId","draggedElement","indicatorInfo","getDropPlaceholder","x","clientX","y","parentHeadingInfo","isCanvas","grandparent","indexOf","setAttribute","unbindDragStart","unbindDragEnd","error","move","removeAttribute","_defineProperty","RenderLayerIndicator","enabled","indicatorStyles","getOptions","indicatorPosition","color","success","parentPos","parentHeadingPos","left","width","height","background","borderWidth","borderColor","headingPos","pos","RenderIndicator","style","LayerEventContextProvider","coreEventHandler","useEventHandler","handler","derive","EditableLayerName","displayName","custom","hidden","editingName","setEditingName","nameDOM","clickOutside","useCallback","contains","target","window","removeEventListener","ContentEditable","html","disabled","ref","addEventListener","onChange","setCustom","tagName","onDoubleClick","_path","_extends","Object","assign","bind","i","source","prototype","hasOwnProperty","call","_path2","SvgArrow","props","xmlns","viewBox","d","SvgEye","fill","SvgLinked","lightTheme","bgBase","bgHover","bgSelected","bgCanvas","textPrimary","textSelected","iconPrimary","iconSelected","shadowColor","darkTheme","getTheme","mode","ThemeContext","ThemeProvider","theme","themeMode","useLayerTheme","context","StyledDiv","styled","div","$selected","$theme","$depth","Expand","a","$expanded","Hide","$isHidden","TopLevelIndicator","DefaultLayerHeader","topLevel","isTopLevelCanvas","onClick","setHidden","Eye","Linked","onMouseDown","Arrow","LayerNodeDiv","$hovered","$hasCanvases","LayerChildren","DefaultLayer","hasChildCanvases","isParentOfTopLevelNodes","LayerManagerProvider","useMethods","dragged","Layers"],"mappings":"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"}