{"version":3,"file":"DefaultLayerHeader.js","sourceRoot":"","sources":["../../../src/layers/DefaultLayer/DefaultLayerHeader.tsx"],"names":[],"mappings":"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","sourcesContent":["import { useEditor } from '@craftjs/core';\nimport React from 'react';\nimport { styled } from 'styled-components';\n\nimport { EditableLayerName } from './EditableLayerName';\nimport Arrow from './svg/arrow.svg';\nimport Eye from './svg/eye.svg';\nimport Grip from './svg/grip.svg';\nimport Linked from './svg/linked.svg';\n\nimport { LayersTheme } from '../../theme';\nimport { useLayerTheme } from '../ThemeContext';\nimport { useLayer } from '../useLayer';\n\nconst StyledDiv = styled.div<{\n  $depth: number;\n  $selected: boolean;\n  $theme: LayersTheme;\n}>`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding: 4px 10px;\n  background: ${(props) =>\n    props.$selected ? props.$theme.bgSelected : 'transparent'};\n  color: ${(props) =>\n    props.$selected ? props.$theme.textSelected : props.$theme.textPrimary};\n  svg {\n    fill: ${(props) =>\n      props.$selected ? props.$theme.iconSelected : props.$theme.iconPrimary};\n    margin-top: 2px;\n  }\n  .inner {\n    flex: 1;\n    > div {\n      padding: 0px;\n      flex: 1;\n      display: flex;\n      margin-left: ${(props) => Math.min(props.$depth * 8, 40)}px;\n      align-items: center;\n      div.layer-name {\n        flex: 1;\n        h2 {\n          font-size: 15px;\n          line-height: 26px;\n        }\n      }\n    }\n  }\n`;\n\nconst Expand = styled.a<{ $expanded: boolean }>`\n  width: 8px;\n  height: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transform-origin: center;\n  transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);\n  transform: rotate(${(props) => (props.$expanded ? 180 : 0)}deg);\n  opacity: 0.7;\n  cursor: pointer;\n`;\n\nconst Hide = styled.a<{\n  $selected: boolean;\n  $isHidden: boolean;\n  $theme: LayersTheme;\n}>`\n  width: 14px;\n  height: 14px;\n  margin-right: 10px;\n  position: relative;\n  transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);\n  cursor: pointer;\n\n  svg {\n    width: 100%;\n    height: 100%;\n    object-fit: contain;\n    opacity: ${(props) => (props.$isHidden ? 0.2 : 1)};\n  }\n  &:after {\n    content: ' ';\n    width: 2px;\n    height: ${(props) => (props.$isHidden ? 100 : 0)}%;\n    position: absolute;\n    left: 2px;\n    top: 3px;\n    background: ${(props) =>\n      props.$selected ? props.$theme.iconSelected : props.$theme.iconPrimary};\n    transform: rotate(-45deg);\n    transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);\n    transform-origin: 0% 0%;\n    opacity: ${(props) => (props.$isHidden ? 0.4 : 1)};\n  }\n`;\n\nconst TopLevelIndicator = styled.div`\n  margin-left: -22px;\n  margin-right: 10px;\n\n  svg {\n    width: 12px;\n    height: 12px;\n  }\n`;\n\nconst DragHandle = styled.div<{\n  $theme: LayersTheme;\n}>`\n  width: 20px;\n  height: 20px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: grab;\n  opacity: 0.4;\n  transition: opacity 0.2s ease;\n  margin-right: 4px;\n  flex-shrink: 0;\n\n  &:hover {\n    opacity: 0.8;\n  }\n\n  &:active {\n    cursor: grabbing;\n    opacity: 1;\n  }\n\n  svg {\n    width: 14px;\n    height: 14px;\n    pointer-events: none;\n  }\n`;\n\nconst ReorderButtons = styled.div<{\n  $theme: LayersTheme;\n}>`\n  display: flex;\n  gap: 2px;\n  margin-left: auto;\n  opacity: 0;\n  transition: opacity 0.2s ease;\n`;\n\nconst ReorderButton = styled.button<{\n  $theme: LayersTheme;\n  $disabled?: boolean;\n}>`\n  width: 18px;\n  height: 18px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: transparent;\n  border: none;\n  cursor: ${(props) => (props.$disabled ? 'not-allowed' : 'pointer')};\n  opacity: ${(props) => (props.$disabled ? 0.3 : 0.6)};\n  transition: opacity 0.2s ease;\n  padding: 0;\n  border-radius: 3px;\n\n  &:hover {\n    opacity: ${(props) => (props.$disabled ? 0.3 : 1)};\n    background: ${(props) =>\n      props.$disabled ? 'transparent' : props.$theme.bgHover};\n  }\n\n  svg {\n    width: 12px;\n    height: 12px;\n    pointer-events: none;\n  }\n`;\n\nexport const DefaultLayerHeader = () => {\n  const theme = useLayerTheme();\n  const {\n    id,\n    depth,\n    expanded,\n    children,\n    connectors: { drag, layerHeader },\n    actions: { toggleLayer },\n  } = useLayer((layer) => {\n    return {\n      expanded: layer.expanded,\n    };\n  });\n\n  const {\n    hidden,\n    actions,\n    selected,\n    topLevel,\n    parent,\n    currentIndex,\n    canMoveUp,\n    canMoveDown,\n  } = useEditor((state, query) => {\n    // TODO: handle multiple selected elements\n    const selected = query.getEvent('selected').first() === id;\n    const node = state.nodes[id];\n    const parent = node?.data?.parent ? state.nodes[node.data.parent] : null;\n    const siblings = parent?.data?.nodes || [];\n    const currentIndex = siblings.indexOf(id);\n\n    return {\n      hidden: node && node.data.hidden,\n      selected,\n      topLevel: query.node(id).isTopLevelCanvas(),\n      parent,\n      currentIndex,\n      canMoveUp: currentIndex > 0,\n      canMoveDown: currentIndex < siblings.length - 1 && currentIndex !== -1,\n    };\n  });\n\n  const handleMoveUp = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (!canMoveUp || !parent) return;\n    // Move to previous position\n    actions.move(id, parent.id, currentIndex - 1);\n  };\n\n  const handleMoveDown = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (!canMoveDown || !parent) return;\n    // When moving down, the node is removed first, so we need to add 2\n    // to account for: current position removal + skip the next sibling\n    actions.move(id, parent.id, currentIndex + 2);\n  };\n\n  const [isHovered, setIsHovered] = React.useState(false);\n\n  return (\n    <StyledDiv\n      $selected={selected}\n      $depth={depth}\n      $theme={theme}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n    >\n      <DragHandle\n        ref={(dom) => {\n          drag(dom);\n        }}\n        $theme={theme}\n      >\n        <Grip />\n      </DragHandle>\n      <Hide\n        $selected={selected}\n        $isHidden={hidden}\n        $theme={theme}\n        onClick={() => actions.setHidden(id, !hidden)}\n      >\n        <Eye />\n      </Hide>\n      <div className=\"inner\">\n        <div\n          ref={(dom) => {\n            layerHeader(dom);\n          }}\n        >\n          {topLevel ? (\n            <TopLevelIndicator>\n              <Linked />\n            </TopLevelIndicator>\n          ) : null}\n\n          <div className=\"layer-name s\">\n            <EditableLayerName />\n          </div>\n          <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\n            {!topLevel && isHovered && (\n              <ReorderButtons\n                $theme={theme}\n                style={{ opacity: isHovered ? 1 : 0 }}\n              >\n                <ReorderButton\n                  $theme={theme}\n                  $disabled={!canMoveUp}\n                  onClick={handleMoveUp}\n                  title=\"Move up\"\n                >\n                  <svg viewBox=\"0 0 16 16\" fill=\"currentColor\">\n                    <path d=\"M8 3l-5 5h10z\" />\n                  </svg>\n                </ReorderButton>\n                <ReorderButton\n                  $theme={theme}\n                  $disabled={!canMoveDown}\n                  onClick={handleMoveDown}\n                  title=\"Move down\"\n                >\n                  <svg viewBox=\"0 0 16 16\" fill=\"currentColor\">\n                    <path d=\"M8 13l5-5H3z\" />\n                  </svg>\n                </ReorderButton>\n              </ReorderButtons>\n            )}\n            {children && children.length ? (\n              <Expand $expanded={expanded} onMouseDown={() => toggleLayer()}>\n                <Arrow />\n              </Expand>\n            ) : null}\n          </div>\n        </div>\n      </div>\n    </StyledDiv>\n  );\n};\n"]}