{"version":3,"file":"index.js","sources":["../../src/nodes/NodeContext.tsx","../../src/editor/EditorContext.tsx","../../src/events/EventContext.ts","../../src/editor/useInternalEditor.ts","../../src/nodes/useInternalNode.ts","../../src/hooks/useNode.ts","../../src/render/SimpleElement.tsx","../../src/render/DefaultRender.tsx","../../src/render/RenderNode.tsx","../../src/nodes/NodeElement.tsx","../../src/nodes/Element.tsx","../../src/nodes/Canvas.tsx","../../src/render/Frame.tsx","../../src/interfaces/nodes.ts","../../src/hooks/useEditor.tsx","../../src/hooks/legacy/connectEditor.tsx","../../src/hooks/legacy/connectNode.tsx","../../src/utils/fromEntries.ts","../../src/utils/getNodesFromSelector.ts","../../src/utils/removeNodeFromEvents.ts","../../src/editor/actions.ts","../../src/editor/EventHelpers.ts","../../src/utils/resolveComponent.ts","../../src/utils/serializeNode.tsx","../../src/editor/NodeHelpers.ts","../../src/events/findPosition.ts","../../src/utils/createNode.ts","../../src/utils/deserializeNode.tsx","../../src/utils/mergeTrees.tsx","../../src/utils/parseNodeFromJSX.tsx","../../src/editor/query.tsx","../../src/events/CoreEventHandlers.ts","../../src/events/Positioner.ts","../../src/events/createShadow.ts","../../src/events/DefaultEventHandlers.ts","../../src/events/movePlaceholder.ts","../../src/events/RenderEditorIndicator.tsx","../../src/events/Events.tsx","../../src/editor/store.tsx","../../src/editor/Editor.tsx","../../src/utils/testHelpers.ts"],"sourcesContent":["import React from 'react';\n\nimport { NodeId } from '../interfaces';\n\nexport type NodeContextType = {\n  id: NodeId;\n  related?: boolean;\n};\n\nexport const NodeContext = React.createContext<NodeContextType>(null);\n\nexport type NodeProviderProps = Omit<NodeContextType, 'connectors'> & {\n  children?: React.ReactNode;\n};\n\nexport const NodeProvider = ({\n  id,\n  related = false,\n  children,\n}: NodeProviderProps) => {\n  return (\n    <NodeContext.Provider value={{ id, related }}>\n      {children}\n    </NodeContext.Provider>\n  );\n};\n","import { createContext } from 'react';\n\nimport { EditorStore } from './store';\n\nexport type EditorContextType = EditorStore;\nexport const EditorContext = createContext<EditorContextType>(null);\n","import { createContext, useContext } from 'react';\n\nimport { CoreEventHandlers } from './CoreEventHandlers';\n\nexport const EventHandlerContext = createContext<CoreEventHandlers>(null);\n\nexport const useEventHandler = () => useContext(EventHandlerContext);\n","import {\n  useCollector,\n  useCollectorReturnType,\n  QueryCallbacksFor,\n  wrapConnectorHooks,\n  EventHandlerConnectors,\n  ERROR_USE_EDITOR_OUTSIDE_OF_EDITOR_CONTEXT,\n} from '@craftjs/utils';\nimport { useContext, useEffect, useMemo } from 'react';\nimport invariant from 'tiny-invariant';\n\nimport { EditorContext } from './EditorContext';\nimport { QueryMethods } from './query';\nimport { EditorStore } from './store';\n\nimport { CoreEventHandlers } from '../events/CoreEventHandlers';\nimport { useEventHandler } from '../events/EventContext';\nimport { EditorState } from '../interfaces';\n\nexport type EditorCollector<C> = (\n  state: EditorState,\n  query: QueryCallbacksFor<typeof QueryMethods>\n) => C;\n\nexport type useInternalEditorReturnType<C = null> = useCollectorReturnType<\n  EditorStore,\n  C\n> & {\n  inContext: boolean;\n  store: EditorStore;\n  connectors: EventHandlerConnectors<CoreEventHandlers, React.ReactElement>;\n};\n\nexport function useInternalEditor<C>(\n  collector?: EditorCollector<C>\n): useInternalEditorReturnType<C> {\n  const handler = useEventHandler();\n  const store = useContext(EditorContext);\n  invariant(store, ERROR_USE_EDITOR_OUTSIDE_OF_EDITOR_CONTEXT);\n\n  const collected = useCollector(store, collector);\n\n  const connectorsUsage = useMemo(\n    () => handler && handler.createConnectorsUsage(),\n    [handler]\n  );\n\n  useEffect(() => {\n    connectorsUsage.register();\n\n    return () => {\n      connectorsUsage.cleanup();\n    };\n  }, [connectorsUsage]);\n\n  const connectors = useMemo(\n    () => connectorsUsage && wrapConnectorHooks(connectorsUsage.connectors),\n    [connectorsUsage]\n  );\n\n  return {\n    ...collected,\n    connectors,\n    inContext: !!store,\n    store,\n  };\n}\n","import {\n  wrapConnectorHooks,\n  ERROR_USE_NODE_OUTSIDE_OF_EDITOR_CONTEXT,\n} from '@craftjs/utils';\nimport { useMemo, useContext } from 'react';\nimport invariant from 'tiny-invariant';\n\nimport { NodeContext } from './NodeContext';\n\nimport { useInternalEditor } from '../editor/useInternalEditor';\nimport { Node } from '../interfaces';\n\nexport function useInternalNode<S = null>(collect?: (node: Node) => S) {\n  const context = useContext(NodeContext);\n  invariant(context, ERROR_USE_NODE_OUTSIDE_OF_EDITOR_CONTEXT);\n\n  const { id, related } = context;\n\n  const {\n    actions: EditorActions,\n    query,\n    connectors: editorConnectors,\n    ...collected\n  } = useInternalEditor(\n    (state) => id && state.nodes[id] && collect && collect(state.nodes[id])\n  );\n\n  const connectors = useMemo(\n    () =>\n      wrapConnectorHooks({\n        connect: (dom: HTMLElement) => editorConnectors.connect(dom, id),\n        drag: (dom: HTMLElement) => editorConnectors.drag(dom, id),\n      }),\n    [editorConnectors, id]\n  );\n\n  const actions = useMemo(() => {\n    return {\n      setProp: (cb: any, throttleRate?: number) => {\n        if (throttleRate) {\n          EditorActions.history.throttle(throttleRate).setProp(id, cb);\n        } else {\n          EditorActions.setProp(id, cb);\n        }\n      },\n      setCustom: (cb: any, throttleRate?: number) => {\n        if (throttleRate) {\n          EditorActions.history.throttle(throttleRate).setCustom(id, cb);\n        } else {\n          EditorActions.setCustom(id, cb);\n        }\n      },\n      setHidden: (bool: boolean) => EditorActions.setHidden(id, bool),\n    };\n  }, [EditorActions, id]);\n\n  return {\n    ...collected,\n    id,\n    related,\n    inNodeContext: !!context,\n    actions,\n    connectors,\n  };\n}\n","import { deprecationWarning } from '@craftjs/utils';\n\nimport { Node } from '../interfaces';\nimport { useInternalNode } from '../nodes/useInternalNode';\n\n/**\n * A Hook to that provides methods and state information related to the corresponding Node that manages the current component.\n * @param collect - Collector function to consume values from the corresponding Node's state\n */\nexport function useNode<S = null>(collect?: (node: Node) => S) {\n  const {\n    id,\n    related,\n    actions,\n    inNodeContext,\n    connectors,\n    ...collected\n  } = useInternalNode(collect);\n\n  return {\n    ...collected,\n    actions,\n    id,\n    related,\n    setProp: (\n      cb: (props: Record<string, any>) => void,\n      throttleRate?: number\n    ) => {\n      deprecationWarning('useNode().setProp()', {\n        suggest: 'useNode().actions.setProp()',\n      });\n      return actions.setProp(cb, throttleRate);\n    },\n    inNodeContext,\n    connectors,\n  };\n}\n","import React from 'react';\n\nimport { useNode } from '../hooks/useNode';\n\nexport const SimpleElement = ({ render }: any) => {\n  const {\n    connectors: { connect, drag },\n  } = useNode();\n\n  return typeof render.type === 'string'\n    ? connect(drag(React.cloneElement(render)))\n    : render;\n};\n","import React, { useMemo } from 'react';\n\nimport { SimpleElement } from './SimpleElement';\n\nimport { NodeId } from '../interfaces';\nimport { NodeElement } from '../nodes/NodeElement';\nimport { useInternalNode } from '../nodes/useInternalNode';\n\nexport const DefaultRender = () => {\n  const { type, props, nodes, hydrationTimestamp } = useInternalNode(\n    (node) => ({\n      type: node.data.type,\n      props: node.data.props,\n      nodes: node.data.nodes,\n      hydrationTimestamp: node._hydrationTimestamp,\n    })\n  );\n\n  return useMemo(() => {\n    let children = props.children;\n\n    if (nodes && nodes.length > 0) {\n      children = (\n        <React.Fragment>\n          {nodes.map((id: NodeId) => (\n            <NodeElement id={id} key={id} />\n          ))}\n        </React.Fragment>\n      );\n    }\n\n    const render = React.createElement(type, props, children);\n\n    if (typeof type == 'string') {\n      return <SimpleElement render={render} />;\n    }\n\n    return render;\n    // eslint-disable-next-line  react-hooks/exhaustive-deps\n  }, [type, props, hydrationTimestamp, nodes]);\n};\n","import React from 'react';\n\nimport { DefaultRender } from './DefaultRender';\n\nimport { useInternalEditor } from '../editor/useInternalEditor';\nimport { useInternalNode } from '../nodes/useInternalNode';\n\ntype RenderNodeToElementProps = {\n  render?: React.ReactElement;\n  children?: React.ReactNode;\n};\nexport const RenderNodeToElement = ({ render }: RenderNodeToElementProps) => {\n  const { hidden } = useInternalNode((node) => ({\n    hidden: node.data.hidden,\n  }));\n\n  const { onRender } = useInternalEditor((state) => ({\n    onRender: state.options.onRender,\n  }));\n\n  // don't display the node since it's hidden\n  if (hidden) {\n    return null;\n  }\n\n  return React.createElement(onRender, { render: render || <DefaultRender /> });\n};\n","import React from 'react';\n\nimport { NodeProvider } from './NodeContext';\n\nimport { NodeId } from '../interfaces';\nimport { RenderNodeToElement } from '../render/RenderNode';\n\nexport type NodeElementProps = {\n  id: NodeId;\n  render?: React.ReactElement;\n};\n\nexport const NodeElement = ({ id, render }: NodeElementProps) => {\n  return (\n    <NodeProvider id={id}>\n      <RenderNodeToElement render={render} />\n    </NodeProvider>\n  );\n};\n","import { ERROR_TOP_LEVEL_ELEMENT_NO_ID } from '@craftjs/utils';\nimport React, { useState } from 'react';\nimport invariant from 'tiny-invariant';\n\nimport { NodeElement } from './NodeElement';\nimport { useInternalNode } from './useInternalNode';\n\nimport { useInternalEditor } from '../editor/useInternalEditor';\nimport { NodeId } from '../interfaces';\n\nexport const defaultElementProps = {\n  is: 'div',\n  canvas: false,\n  custom: {},\n  hidden: false,\n};\n\nexport const elementPropToNodeData = {\n  is: 'type',\n  canvas: 'isCanvas',\n};\n\nexport type ElementProps<T extends React.ElementType> = {\n  id?: NodeId;\n  is?: T;\n  custom?: Record<string, any>;\n  children?: React.ReactNode;\n  canvas?: boolean;\n  hidden?: boolean;\n} & React.ComponentProps<T>;\n\nexport function Element<T extends React.ElementType>({\n  id,\n  children,\n  ...elementProps\n}: ElementProps<T>) {\n  const { is } = {\n    ...defaultElementProps,\n    ...elementProps,\n  };\n\n  const { query, actions } = useInternalEditor();\n  const { id: nodeId, inNodeContext } = useInternalNode();\n\n  const [linkedNodeId] = useState<NodeId | null>(() => {\n    invariant(!!id, ERROR_TOP_LEVEL_ELEMENT_NO_ID);\n    const node = query.node(nodeId).get();\n\n    if (inNodeContext) {\n      const existingNode = node.data.linkedNodes[id]\n        ? query.node(node.data.linkedNodes[id]).get()\n        : null;\n\n      // Render existing linked Node if it already exists (and is the same type as the JSX)\n      if (existingNode && existingNode.data.type === is) {\n        return existingNode.id;\n      }\n\n      // otherwise, create and render a new linked Node\n      const linkedElement = React.createElement(\n        Element,\n        elementProps,\n        children\n      );\n\n      const tree = query.parseReactElement(linkedElement).toNodeTree();\n\n      actions.history.ignore().addLinkedNodeFromTree(tree, nodeId, id);\n      return tree.rootNodeId;\n    }\n    return null;\n  });\n\n  return linkedNodeId ? <NodeElement id={linkedNodeId} /> : null;\n}\n","import { deprecationWarning } from '@craftjs/utils';\nimport React, { useEffect } from 'react';\n\nimport { Element, ElementProps } from './Element';\n\nexport type CanvasProps<T extends React.ElementType> = ElementProps<T>;\n\nexport const deprecateCanvasComponent = () =>\n  deprecationWarning('<Canvas />', {\n    suggest: '<Element canvas={true} />',\n  });\n\nexport function Canvas<T extends React.ElementType>({\n  ...props\n}: CanvasProps<T>) {\n  useEffect(() => deprecateCanvasComponent(), []);\n\n  return <Element {...props} canvas={true} />;\n}\n","import { deprecationWarning, ROOT_NODE } from '@craftjs/utils';\nimport React, { useRef } from 'react';\n\nimport { useInternalEditor } from '../editor/useInternalEditor';\nimport { SerializedNodes } from '../interfaces';\nimport { NodeElement } from '../nodes/NodeElement';\n\nexport type FrameProps = {\n  children?: React.ReactNode;\n  json?: string;\n  data?: string | SerializedNodes;\n};\n\nconst RenderRootNode = () => {\n  const { timestamp } = useInternalEditor((state) => ({\n    timestamp:\n      state.nodes[ROOT_NODE] && state.nodes[ROOT_NODE]._hydrationTimestamp,\n  }));\n\n  if (!timestamp) {\n    return null;\n  }\n\n  return <NodeElement id={ROOT_NODE} key={timestamp} />;\n};\n\n/**\n * A React Component that defines the editable area\n */\nexport const Frame = ({ children, json, data }: FrameProps) => {\n  const { actions, query } = useInternalEditor();\n\n  if (!!json) {\n    deprecationWarning('<Frame json={...} />', {\n      suggest: '<Frame data={...} />',\n    });\n  }\n\n  const isLoaded = useRef(false);\n\n  if (!isLoaded.current) {\n    const initialData = data || json;\n\n    if (initialData) {\n      actions.history.ignore().deserialize(initialData);\n    } else if (children) {\n      const rootNode = React.Children.only(children) as React.ReactElement;\n\n      const node = query.parseReactElement(rootNode).toNodeTree((node, jsx) => {\n        if (jsx === rootNode) {\n          node.id = ROOT_NODE;\n        }\n        return node;\n      });\n\n      actions.history.ignore().addNodeTree(node);\n    }\n\n    isLoaded.current = true;\n  }\n\n  return <RenderRootNode />;\n};\n","import { QueryCallbacksFor } from '@craftjs/utils';\nimport React from 'react';\n\nimport { QueryMethods } from '../editor/query';\n\nexport type UserComponentConfig<T> = {\n  displayName: string;\n  rules: Partial<NodeRules>;\n  related: Partial<NodeRelated>;\n  props: Partial<T>;\n  custom: Record<string, any>;\n  info: Record<string, any>;\n  isCanvas: boolean;\n\n  // TODO: Deprecate\n  name: string;\n  defaultProps: Partial<T>;\n};\n\nexport type UserComponent<T = any> = React.ComponentType<T> & {\n  craft?: Partial<UserComponentConfig<T>>;\n};\n\nexport type NodeId = string;\nexport type NodeEventTypes = 'selected' | 'dragged' | 'hovered';\n\nexport type Node = {\n  id: NodeId;\n  data: NodeData;\n  info: Record<string, any>;\n  events: Record<NodeEventTypes, boolean>;\n  dom: HTMLElement | null;\n  related: Record<string, React.ElementType>;\n  rules: NodeRules;\n  _hydrationTimestamp: number;\n};\n\nexport type NodeHelpersType = QueryCallbacksFor<typeof QueryMethods>['node'];\nexport type NodeRules = {\n  canDrag(node: Node, helpers: NodeHelpersType): boolean;\n  canDrop(dropTarget: Node, self: Node, helpers: NodeHelpersType): boolean;\n  canMoveIn(canMoveIn: Node[], self: Node, helpers: NodeHelpersType): boolean;\n  canMoveOut(canMoveOut: Node[], self: Node, helpers: NodeHelpersType): boolean;\n};\nexport type NodeRelated = Record<string, React.ElementType>;\n\nexport type NodeData = {\n  props: Record<string, any>;\n  type: string | React.ElementType;\n  name: string;\n  displayName: string;\n  isCanvas: boolean;\n  parent: NodeId | null;\n  linkedNodes: Record<string, NodeId>;\n  nodes: NodeId[];\n  hidden: boolean;\n  custom?: any;\n  _childCanvas?: Record<string, NodeId>; // TODO: Deprecate in favour of linkedNodes\n};\n\nexport type FreshNode = {\n  id?: NodeId;\n  data: Partial<NodeData> & Required<Pick<NodeData, 'type'>>;\n};\n\nexport type ReduceCompType =\n  | string\n  | {\n      resolvedName: string;\n    };\n\nexport type ReducedComp = {\n  type: ReduceCompType;\n  isCanvas: boolean;\n  props: any;\n};\n\nexport type SerializedNode = Omit<\n  NodeData,\n  'type' | 'subtype' | 'name' | 'event'\n> &\n  ReducedComp;\n\nexport type SerializedNodes = Record<NodeId, SerializedNode>;\n\n// TODO: Deprecate in favor of SerializedNode\nexport type SerializedNodeData = SerializedNode;\n\nexport type Nodes = Record<NodeId, Node>;\n\n/**\n * A NodeTree is an internal data structure for CRUD operations that involve\n * more than a single node.\n *\n * For example, when we drop a component we use a tree because we\n * need to drop more than a single component.\n */\nexport interface NodeTree {\n  rootNodeId: NodeId;\n  nodes: Nodes;\n}\n\ntype NodeIdSelector = NodeId | NodeId[];\ntype NodeObjSelector = Node | Node[];\n\nexport enum NodeSelectorType {\n  Any,\n  Id,\n  Obj,\n}\n\nexport type NodeSelector<\n  T extends NodeSelectorType = NodeSelectorType.Any\n> = T extends NodeSelectorType.Id\n  ? NodeIdSelector\n  : T extends NodeSelectorType.Obj\n  ? NodeObjSelector\n  : NodeIdSelector | NodeObjSelector;\n\nexport type NodeSelectorWrapper = {\n  node: Node;\n  exists: boolean;\n};\n","import { Overwrite, Delete, OverwriteFnReturnType } from '@craftjs/utils';\nimport { useMemo } from 'react';\n\nimport {\n  useInternalEditor,\n  EditorCollector,\n  useInternalEditorReturnType,\n} from '../editor/useInternalEditor';\n\ntype PrivateActions =\n  | 'addLinkedNodeFromTree'\n  | 'setNodeEvent'\n  | 'setDOM'\n  | 'replaceNodes'\n  | 'reset';\n\nconst getPublicActions = (actions) => {\n  const {\n    addLinkedNodeFromTree,\n    setDOM,\n    setNodeEvent,\n    replaceNodes,\n    reset,\n    ...EditorActions\n  } = actions;\n\n  return EditorActions;\n};\n\nexport type WithoutPrivateActions<S = null> = Delete<\n  useInternalEditorReturnType<S>['actions'],\n  PrivateActions | 'history'\n> & {\n  history: Overwrite<\n    useInternalEditorReturnType<S>['actions']['history'],\n    {\n      ignore: OverwriteFnReturnType<\n        useInternalEditorReturnType<S>['actions']['history']['ignore'],\n        PrivateActions\n      >;\n      throttle: OverwriteFnReturnType<\n        useInternalEditorReturnType<S>['actions']['history']['throttle'],\n        PrivateActions\n      >;\n    }\n  >;\n};\n\nexport type useEditorReturnType<S = null> = Overwrite<\n  useInternalEditorReturnType<S>,\n  {\n    actions: WithoutPrivateActions;\n    query: Delete<useInternalEditorReturnType<S>['query'], 'deserialize'>;\n  }\n>;\n\n/**\n * A Hook that that provides methods and information related to the entire editor state.\n * @param collector Collector function to consume values from the editor's state\n */\nexport function useEditor(): useEditorReturnType;\nexport function useEditor<S>(\n  collect: EditorCollector<S>\n): useEditorReturnType<S>;\n\nexport function useEditor<S>(collect?: any): useEditorReturnType<S> {\n  const {\n    connectors,\n    actions: internalActions,\n    query,\n    store,\n    ...collected\n  } = useInternalEditor(collect);\n\n  const EditorActions = getPublicActions(internalActions);\n\n  const actions = useMemo(() => {\n    return {\n      ...EditorActions,\n      history: {\n        ...EditorActions.history,\n        ignore: (...args) =>\n          getPublicActions(EditorActions.history.ignore(...args)),\n        throttle: (...args) =>\n          getPublicActions(EditorActions.history.throttle(...args)),\n      },\n    };\n  }, [EditorActions]);\n\n  return {\n    connectors,\n    actions,\n    query,\n    store,\n    ...(collected as any),\n  };\n}\n","import React from 'react';\n\nimport { EditorState } from '../../interfaces';\nimport { useEditor } from '../useEditor';\n\nexport function connectEditor<C>(collect?: (state: EditorState) => C) {\n  return (WrappedComponent: React.ElementType) => {\n    return (props: any) => {\n      const Editor = collect ? useEditor(collect) : useEditor();\n      return <WrappedComponent {...Editor} {...props} />;\n    };\n  };\n}\n","import React from 'react';\n\nimport { Node } from '../../interfaces';\nimport { useNode } from '../useNode';\n\nexport function connectNode<C>(collect?: (state: Node) => C) {\n  return function (WrappedComponent: React.ElementType) {\n    return (props: any) => {\n      const node = useNode(collect);\n      return <WrappedComponent {...node} {...props} />;\n    };\n  };\n}\n","export const fromEntries = (pairs) => {\n  if (Object.fromEntries) {\n    return Object.fromEntries(pairs);\n  }\n  return pairs.reduce(\n    (accum, [id, value]) => ({\n      ...accum,\n      [id]: value,\n    }),\n    {}\n  );\n};\n","import { ERROR_INVALID_NODEID } from '@craftjs/utils';\nimport invariant from 'tiny-invariant';\n\nimport { Nodes, Node, NodeSelectorWrapper, NodeSelector } from '../interfaces';\n\ntype config = { existOnly: boolean; idOnly: boolean };\nexport const getNodesFromSelector = (\n  nodes: Nodes,\n  selector: NodeSelector,\n  config?: Partial<config>\n): NodeSelectorWrapper[] => {\n  const items = Array.isArray(selector) ? selector : [selector];\n\n  const mergedConfig = {\n    existOnly: false,\n    idOnly: false,\n    ...(config || {}),\n  };\n\n  const nodeSelectors = items\n    .filter((item) => !!item)\n    .map((item) => {\n      if (typeof item === 'string') {\n        return {\n          node: nodes[item],\n          exists: !!nodes[item],\n        };\n      }\n\n      if (typeof item === 'object' && !mergedConfig.idOnly) {\n        const node = item as Node;\n        return {\n          node,\n          exists: !!nodes[node.id],\n        };\n      }\n\n      return {\n        node: null,\n        exists: false,\n      };\n    });\n\n  if (mergedConfig.existOnly) {\n    invariant(\n      nodeSelectors.filter((selector) => !selector.exists).length === 0,\n      ERROR_INVALID_NODEID\n    );\n  }\n\n  return nodeSelectors;\n};\n","import { EditorState, NodeId } from '../interfaces';\n\nexport const removeNodeFromEvents = (state: EditorState, nodeId: NodeId) =>\n  Object.keys(state.events).forEach((key) => {\n    const eventSet = state.events[key];\n    if (eventSet && eventSet.has && eventSet.has(nodeId)) {\n      state.events[key] = new Set(\n        Array.from(eventSet).filter((id) => nodeId !== id)\n      );\n    }\n  });\n","import {\n  deprecationWarning,\n  ERROR_INVALID_NODEID,\n  ROOT_NODE,\n  DEPRECATED_ROOT_NODE,\n  QueryCallbacksFor,\n  ERROR_NOPARENT,\n  ERROR_DELETE_TOP_LEVEL_NODE,\n  CallbacksFor,\n  Delete,\n  ERROR_NOT_IN_RESOLVER,\n} from '@craftjs/utils';\nimport invariant from 'tiny-invariant';\n\nimport { QueryMethods } from './query';\n\nimport {\n  EditorState,\n  Indicator,\n  NodeId,\n  Node,\n  Nodes,\n  Options,\n  NodeEventTypes,\n  NodeTree,\n  SerializedNodes,\n  NodeSelector,\n  NodeSelectorType,\n} from '../interfaces';\nimport { fromEntries } from '../utils/fromEntries';\nimport { getNodesFromSelector } from '../utils/getNodesFromSelector';\nimport { removeNodeFromEvents } from '../utils/removeNodeFromEvents';\n\nconst Methods = (\n  state: EditorState,\n  query: QueryCallbacksFor<typeof QueryMethods>\n) => {\n  /** Helper functions */\n  const addNodeTreeToParent = (\n    tree: NodeTree,\n    parentId?: NodeId,\n    addNodeType?:\n      | {\n          type: 'child';\n          index: number;\n        }\n      | {\n          type: 'linked';\n          id: string;\n        }\n  ) => {\n    const iterateChildren = (id: NodeId, parentId?: NodeId) => {\n      const node = tree.nodes[id];\n\n      if (typeof node.data.type !== 'string') {\n        invariant(\n          state.options.resolver[node.data.name],\n          ERROR_NOT_IN_RESOLVER.replace(\n            '%node_type%',\n            `${(node.data.type as any).name}`\n          )\n        );\n      }\n\n      state.nodes[id] = {\n        ...node,\n        data: {\n          ...node.data,\n          parent: parentId,\n        },\n      };\n\n      if (node.data.nodes.length > 0) {\n        delete state.nodes[id].data.props.children;\n        node.data.nodes.forEach((childNodeId) =>\n          iterateChildren(childNodeId, node.id)\n        );\n      }\n\n      Object.values(node.data.linkedNodes).forEach((linkedNodeId) =>\n        iterateChildren(linkedNodeId, node.id)\n      );\n    };\n\n    iterateChildren(tree.rootNodeId, parentId);\n\n    if (!parentId && tree.rootNodeId === ROOT_NODE) {\n      return;\n    }\n\n    const parent = getParentAndValidate(parentId);\n\n    if (addNodeType.type === 'child') {\n      const index = addNodeType.index;\n\n      if (index != null) {\n        parent.data.nodes.splice(index, 0, tree.rootNodeId);\n      } else {\n        parent.data.nodes.push(tree.rootNodeId);\n      }\n\n      return;\n    }\n\n    parent.data.linkedNodes[addNodeType.id] = tree.rootNodeId;\n  };\n\n  const getParentAndValidate = (parentId: NodeId): Node => {\n    invariant(parentId, ERROR_NOPARENT);\n    const parent = state.nodes[parentId];\n    invariant(parent, ERROR_INVALID_NODEID);\n    return parent;\n  };\n\n  const deleteNode = (id: NodeId) => {\n    const targetNode = state.nodes[id],\n      parentNode = state.nodes[targetNode.data.parent];\n\n    if (targetNode.data.nodes) {\n      // we deep clone here because otherwise immer will mutate the node\n      // object as we remove nodes\n      [...targetNode.data.nodes].forEach((childId) => deleteNode(childId));\n    }\n\n    if (targetNode.data.linkedNodes) {\n      Object.values(targetNode.data.linkedNodes).map((linkedNodeId) =>\n        deleteNode(linkedNodeId)\n      );\n    }\n\n    const isChildNode = parentNode.data.nodes.includes(id);\n\n    if (isChildNode) {\n      const parentChildren = parentNode.data.nodes;\n      parentChildren.splice(parentChildren.indexOf(id), 1);\n    } else {\n      const linkedId = Object.keys(parentNode.data.linkedNodes).find(\n        (id) => parentNode.data.linkedNodes[id] === id\n      );\n      if (linkedId) {\n        delete parentNode.data.linkedNodes[linkedId];\n      }\n    }\n\n    removeNodeFromEvents(state, id);\n    delete state.nodes[id];\n  };\n\n  return {\n    /**\n     * @private\n     * Add a new linked Node to the editor.\n     * Only used internally by the <Element /> component\n     *\n     * @param tree\n     * @param parentId\n     * @param id\n     */\n    addLinkedNodeFromTree(tree: NodeTree, parentId: NodeId, id: string) {\n      const parent = getParentAndValidate(parentId);\n\n      const existingLinkedNode = parent.data.linkedNodes[id];\n\n      if (existingLinkedNode) {\n        deleteNode(existingLinkedNode);\n      }\n\n      addNodeTreeToParent(tree, parentId, { type: 'linked', id });\n    },\n\n    /**\n     * Add a new Node to the editor.\n     *\n     * @param nodeToAdd\n     * @param parentId\n     * @param index\n     */\n    add(nodeToAdd: Node | Node[], parentId?: NodeId, index?: number) {\n      // TODO: Deprecate adding array of Nodes to keep implementation simpler\n      let nodes = [nodeToAdd];\n      if (Array.isArray(nodeToAdd)) {\n        deprecationWarning('actions.add(node: Node[])', {\n          suggest: 'actions.add(node: Node)',\n        });\n        nodes = nodeToAdd;\n      }\n      nodes.forEach((node: Node) => {\n        addNodeTreeToParent(\n          {\n            nodes: {\n              [node.id]: node,\n            },\n            rootNodeId: node.id,\n          },\n          parentId,\n          { type: 'child', index }\n        );\n      });\n    },\n\n    /**\n     * Add a NodeTree to the editor\n     *\n     * @param tree\n     * @param parentId\n     * @param index\n     */\n    addNodeTree(tree: NodeTree, parentId?: NodeId, index?: number) {\n      addNodeTreeToParent(tree, parentId, { type: 'child', index });\n    },\n\n    /**\n     * Delete a Node\n     * @param id\n     */\n    delete(selector: NodeSelector<NodeSelectorType.Id>) {\n      const targets = getNodesFromSelector(state.nodes, selector, {\n        existOnly: true,\n        idOnly: true,\n      });\n\n      targets.forEach(({ node }) => {\n        invariant(\n          !query.node(node.id).isTopLevelNode(),\n          ERROR_DELETE_TOP_LEVEL_NODE\n        );\n        deleteNode(node.id);\n      });\n    },\n\n    deserialize(input: SerializedNodes | string) {\n      const dehydratedNodes =\n        typeof input == 'string' ? JSON.parse(input) : input;\n\n      const nodePairs = Object.keys(dehydratedNodes).map((id) => {\n        let nodeId = id;\n\n        if (id === DEPRECATED_ROOT_NODE) {\n          nodeId = ROOT_NODE;\n        }\n\n        return [\n          nodeId,\n          query\n            .parseSerializedNode(dehydratedNodes[id])\n            .toNode((node) => (node.id = nodeId)),\n        ];\n      });\n\n      this.replaceNodes(fromEntries(nodePairs));\n    },\n\n    /**\n     * Move a target Node to a new Parent at a given index\n     * @param targetId\n     * @param newParentId\n     * @param index\n     */\n    move(selector: NodeSelector, newParentId: NodeId, index: number) {\n      const targets = getNodesFromSelector(state.nodes, selector, {\n        existOnly: true,\n      });\n\n      const newParent = state.nodes[newParentId];\n\n      const nodesArrToCleanup = new Set<string[]>();\n\n      targets.forEach(({ node: targetNode }, i) => {\n        const targetId = targetNode.id;\n        const currentParentId = targetNode.data.parent;\n\n        query.node(newParentId).isDroppable([targetId], (err) => {\n          throw new Error(err);\n        });\n\n        // modify node props\n        state.options.onBeforeMoveEnd(\n          targetNode,\n          newParent,\n          state.nodes[currentParentId]\n        );\n\n        const currentParent = state.nodes[currentParentId];\n        const currentParentNodes = currentParent.data.nodes;\n\n        nodesArrToCleanup.add(currentParentNodes);\n\n        const oldIndex = currentParentNodes.indexOf(targetId);\n        currentParentNodes[oldIndex] = '$$'; // mark for deletion\n\n        newParent.data.nodes.splice(index + i, 0, targetId);\n\n        state.nodes[targetId].data.parent = newParentId;\n      });\n\n      nodesArrToCleanup.forEach((nodes) => {\n        const length = nodes.length;\n\n        [...nodes].reverse().forEach((value, index) => {\n          if (value !== '$$') {\n            return;\n          }\n\n          nodes.splice(length - 1 - index, 1);\n        });\n      });\n    },\n\n    replaceNodes(nodes: Nodes) {\n      this.clearEvents();\n      state.nodes = nodes;\n    },\n\n    clearEvents() {\n      this.setNodeEvent('selected', null);\n      this.setNodeEvent('hovered', null);\n      this.setNodeEvent('dragged', null);\n      this.setIndicator(null);\n    },\n\n    /**\n     * Resets all the editor state.\n     */\n    reset() {\n      this.clearEvents();\n      this.replaceNodes({});\n    },\n\n    /**\n     * Set editor options via a callback function\n     *\n     * @param cb: function used to set the options.\n     */\n    setOptions(cb: (options: Partial<Options>) => void) {\n      cb(state.options);\n    },\n\n    setNodeEvent(\n      eventType: NodeEventTypes,\n      nodeIdSelector: NodeSelector<NodeSelectorType.Id>\n    ) {\n      state.events[eventType].forEach((id) => {\n        if (state.nodes[id]) {\n          state.nodes[id].events[eventType] = false;\n        }\n      });\n\n      state.events[eventType] = new Set();\n\n      if (!nodeIdSelector) {\n        return;\n      }\n\n      const targets = getNodesFromSelector(state.nodes, nodeIdSelector, {\n        idOnly: true,\n        existOnly: true,\n      });\n\n      const nodeIds: Set<NodeId> = new Set(targets.map(({ node }) => node.id));\n      nodeIds.forEach((id) => {\n        state.nodes[id].events[eventType] = true;\n      });\n      state.events[eventType] = nodeIds;\n    },\n\n    /**\n     * Set custom values to a Node\n     * @param id\n     * @param cb\n     */\n    setCustom<T extends NodeId>(\n      selector: NodeSelector<NodeSelectorType.Id>,\n      cb: (data: EditorState['nodes'][T]['data']['custom']) => void\n    ) {\n      const targets = getNodesFromSelector(state.nodes, selector, {\n        idOnly: true,\n        existOnly: true,\n      });\n\n      targets.forEach(({ node }) => cb(state.nodes[node.id].data.custom));\n    },\n\n    /**\n     * Given a `id`, it will set the `dom` porperty of that node.\n     *\n     * @param id of the node we want to set\n     * @param dom\n     */\n    setDOM(id: NodeId, dom: HTMLElement) {\n      if (!state.nodes[id]) {\n        return;\n      }\n\n      state.nodes[id].dom = dom;\n    },\n\n    setIndicator(indicator: Indicator | null) {\n      if (\n        indicator &&\n        (!indicator.placement.parent.dom ||\n          (indicator.placement.currentNode &&\n            !indicator.placement.currentNode.dom))\n      )\n        return;\n      state.indicator = indicator;\n    },\n\n    /**\n     * Hide a Node\n     * @param id\n     * @param bool\n     */\n    setHidden(id: NodeId, bool: boolean) {\n      state.nodes[id].data.hidden = bool;\n    },\n\n    /**\n     * Update the props of a Node\n     * @param id\n     * @param cb\n     */\n    setProp(\n      selector: NodeSelector<NodeSelectorType.Id>,\n      cb: (props: any) => void\n    ) {\n      const targets = getNodesFromSelector(state.nodes, selector, {\n        idOnly: true,\n        existOnly: true,\n      });\n\n      targets.forEach(({ node }) => cb(state.nodes[node.id].data.props));\n    },\n\n    selectNode(nodeIdSelector?: NodeSelector<NodeSelectorType.Id>) {\n      if (nodeIdSelector) {\n        const targets = getNodesFromSelector(state.nodes, nodeIdSelector, {\n          idOnly: true,\n          existOnly: true,\n        });\n\n        this.setNodeEvent(\n          'selected',\n          targets.map(({ node }) => node.id)\n        );\n      } else {\n        this.setNodeEvent('selected', null);\n      }\n\n      this.setNodeEvent('hovered', null);\n    },\n  };\n};\n\nexport const ActionMethods = (\n  state: EditorState,\n  query: QueryCallbacksFor<typeof QueryMethods>\n) => {\n  return {\n    ...Methods(state, query),\n    // Note: Beware: advanced method! You most likely don't need to use this\n    // TODO: fix parameter types and cleanup the method\n    setState(\n      cb: (\n        state: EditorState,\n        actions: Delete<CallbacksFor<typeof Methods>, 'history'>\n      ) => void\n    ) {\n      const { history, ...actions } = this;\n\n      // We pass the other actions as the second parameter, so that devs could still make use of the predefined actions\n      cb(state, actions);\n    },\n  };\n};\n","import { EditorState, NodeId, NodeEventTypes } from '../interfaces';\n\nexport function EventHelpers(state: EditorState, eventType: NodeEventTypes) {\n  const event = state.events[eventType];\n  return {\n    contains(id: NodeId) {\n      return event.has(id);\n    },\n    isEmpty() {\n      return this.all().length === 0;\n    },\n    first() {\n      const values = this.all();\n      return values[0];\n    },\n    last() {\n      const values = this.all();\n      return values[values.length - 1];\n    },\n    all() {\n      return Array.from(event);\n    },\n    size() {\n      return this.all().length;\n    },\n    at(i: number) {\n      return this.all()[i];\n    },\n    raw() {\n      return event;\n    },\n  };\n}\n","import { ERROR_NOT_IN_RESOLVER } from '@craftjs/utils';\nimport React from 'react';\nimport invariant from 'tiny-invariant';\n\nimport { Resolver } from '../interfaces';\n\ntype ReversedResolver = Map<React.ComponentType | string, string>;\n\ntype CachedResolverData = {\n  resolver: Resolver;\n  reversed: ReversedResolver;\n};\n\nlet CACHED_RESOLVER_DATA: CachedResolverData | null = null;\n\nconst getReversedResolver = (resolver: Resolver): ReversedResolver => {\n  if (CACHED_RESOLVER_DATA && CACHED_RESOLVER_DATA.resolver === resolver) {\n    return CACHED_RESOLVER_DATA.reversed;\n  }\n\n  CACHED_RESOLVER_DATA = {\n    resolver,\n    reversed: new Map(),\n  };\n\n  for (const [name, comp] of Object.entries(resolver)) {\n    CACHED_RESOLVER_DATA.reversed.set(comp, name);\n  }\n\n  return CACHED_RESOLVER_DATA.reversed;\n};\n\nconst getComponentName = (component: React.ElementType): string | undefined => {\n  return (component as any).name || (component as any).displayName;\n};\n\nconst searchComponentInResolver = (\n  resolver: Resolver,\n  comp: React.ElementType\n): string | null => {\n  const name = getReversedResolver(resolver).get(comp);\n  return name !== undefined ? name : null;\n};\n\nexport const resolveComponent = (\n  resolver: Resolver,\n  comp: React.ElementType | string\n): string => {\n  if (typeof comp === 'string') {\n    return comp;\n  }\n\n  const resolvedName = searchComponentInResolver(resolver, comp);\n\n  invariant(\n    resolvedName,\n    ERROR_NOT_IN_RESOLVER.replace('%node_type%', getComponentName(comp))\n  );\n\n  return resolvedName;\n};\n","import React, { Children } from 'react';\n\nimport { resolveComponent } from './resolveComponent';\n\nimport { NodeData, ReducedComp, SerializedNode } from '../interfaces';\nimport { Resolver } from '../interfaces';\n\nconst reduceType = (type: React.ElementType | string, resolver: Resolver) => {\n  if (typeof type === 'string') {\n    return type;\n  }\n  return { resolvedName: resolveComponent(resolver, type) };\n};\n\nexport const serializeComp = (\n  data: Pick<NodeData, 'type' | 'isCanvas' | 'props'>,\n  resolver: Resolver\n): ReducedComp => {\n  let { type, isCanvas, props } = data;\n  props = Object.keys(props).reduce((result: Record<string, any>, key) => {\n    const prop = props[key];\n\n    if (prop === undefined || prop === null || typeof prop === 'function') {\n      return result;\n    }\n\n    if (key === 'children' && typeof prop !== 'string') {\n      result[key] = Children.map(prop, (child) => {\n        if (typeof child === 'string') {\n          return child;\n        }\n        return serializeComp(child, resolver);\n      });\n    } else if (typeof prop.type === 'function') {\n      result[key] = serializeComp(prop, resolver);\n    } else {\n      result[key] = prop;\n    }\n    return result;\n  }, {});\n\n  return {\n    type: reduceType(type, resolver),\n    isCanvas: !!isCanvas,\n    props,\n  };\n};\n\nexport const serializeNode = (\n  data: Omit<NodeData, 'event'>,\n  resolver: Resolver\n): SerializedNode => {\n  const { type, props, isCanvas, name, ...nodeData } = data;\n\n  const reducedComp = serializeComp({ type, isCanvas, props }, resolver);\n\n  return {\n    ...reducedComp,\n    ...nodeData,\n  };\n};\n","import {\n  deprecationWarning,\n  ERROR_CANNOT_DRAG,\n  ERROR_DUPLICATE_NODEID,\n  ERROR_INVALID_NODE_ID,\n  ERROR_MOVE_INCOMING_PARENT,\n  ERROR_MOVE_NONCANVAS_CHILD,\n  ERROR_MOVE_OUTGOING_PARENT,\n  ERROR_MOVE_TO_DESCENDANT,\n  ERROR_MOVE_TO_NONCANVAS_PARENT,\n  ERROR_MOVE_TOP_LEVEL_NODE,\n  ERROR_MOVE_CANNOT_DROP,\n  ROOT_NODE,\n} from '@craftjs/utils';\nimport invariant from 'tiny-invariant';\n\nimport { EditorState, NodeId, NodeSelector } from '../interfaces';\nimport { getNodesFromSelector } from '../utils/getNodesFromSelector';\nimport { serializeNode } from '../utils/serializeNode';\n\nexport function NodeHelpers(state: EditorState, id: NodeId) {\n  invariant(typeof id == 'string', ERROR_INVALID_NODE_ID);\n\n  const node = state.nodes[id];\n\n  const nodeHelpers = (id) => NodeHelpers(state, id);\n\n  return {\n    isCanvas() {\n      return !!node.data.isCanvas;\n    },\n    isRoot() {\n      return node.id === ROOT_NODE;\n    },\n    isLinkedNode() {\n      return (\n        node.data.parent &&\n        nodeHelpers(node.data.parent).linkedNodes().includes(node.id)\n      );\n    },\n    isTopLevelNode() {\n      return this.isRoot() || this.isLinkedNode();\n    },\n    isDeletable() {\n      return !this.isTopLevelNode();\n    },\n    isParentOfTopLevelNodes: () =>\n      node.data.linkedNodes && Object.keys(node.data.linkedNodes).length > 0,\n    isParentOfTopLevelCanvas() {\n      deprecationWarning('query.node(id).isParentOfTopLevelCanvas', {\n        suggest: 'query.node(id).isParentOfTopLevelNodes',\n      });\n      return this.isParentOfTopLevelNodes();\n    },\n    isSelected() {\n      return state.events.selected.has(id);\n    },\n    isHovered() {\n      return state.events.hovered.has(id);\n    },\n    isDragged() {\n      return state.events.dragged.has(id);\n    },\n    get() {\n      return node;\n    },\n    ancestors(deep = false): NodeId[] {\n      function appendParentNode(\n        id: NodeId,\n        ancestors: NodeId[] = [],\n        depth: number = 0\n      ) {\n        const node = state.nodes[id];\n        if (!node) {\n          return ancestors;\n        }\n\n        ancestors.push(id);\n\n        if (!node.data.parent) {\n          return ancestors;\n        }\n\n        if (deep || (!deep && depth === 0)) {\n          ancestors = appendParentNode(node.data.parent, ancestors, depth + 1);\n        }\n        return ancestors;\n      }\n      return appendParentNode(node.data.parent);\n    },\n    descendants(\n      deep = false,\n      includeOnly?: 'linkedNodes' | 'childNodes'\n    ): NodeId[] {\n      function appendChildNode(\n        id: NodeId,\n        descendants: NodeId[] = [],\n        depth: number = 0\n      ) {\n        if (deep || (!deep && depth === 0)) {\n          const node = state.nodes[id];\n\n          if (!node) {\n            return descendants;\n          }\n\n          if (includeOnly !== 'childNodes') {\n            // Include linkedNodes if any\n            const linkedNodes = nodeHelpers(id).linkedNodes();\n\n            linkedNodes.forEach((nodeId) => {\n              descendants.push(nodeId);\n              descendants = appendChildNode(nodeId, descendants, depth + 1);\n            });\n          }\n\n          if (includeOnly !== 'linkedNodes') {\n            const childNodes = nodeHelpers(id).childNodes();\n\n            childNodes.forEach((nodeId) => {\n              descendants.push(nodeId);\n              descendants = appendChildNode(nodeId, descendants, depth + 1);\n            });\n          }\n\n          return descendants;\n        }\n        return descendants;\n      }\n      return appendChildNode(id);\n    },\n    linkedNodes() {\n      return Object.values(node.data.linkedNodes || {});\n    },\n    childNodes() {\n      return node.data.nodes || [];\n    },\n    isDraggable(onError?: (err: string) => void) {\n      try {\n        const targetNode = node;\n        invariant(!this.isTopLevelNode(), ERROR_MOVE_TOP_LEVEL_NODE);\n        invariant(\n          NodeHelpers(state, targetNode.data.parent).isCanvas(),\n          ERROR_MOVE_NONCANVAS_CHILD\n        );\n        invariant(\n          targetNode.rules.canDrag(targetNode, nodeHelpers),\n          ERROR_CANNOT_DRAG\n        );\n        return true;\n      } catch (err) {\n        if (onError) {\n          onError(err);\n        }\n        return false;\n      }\n    },\n    isDroppable(selector: NodeSelector, onError?: (err: string) => void) {\n      const targets = getNodesFromSelector(state.nodes, selector);\n\n      const newParentNode = node;\n\n      try {\n        invariant(this.isCanvas(), ERROR_MOVE_TO_NONCANVAS_PARENT);\n        invariant(\n          newParentNode.rules.canMoveIn(\n            targets.map((selector) => selector.node),\n            newParentNode,\n            nodeHelpers\n          ),\n          ERROR_MOVE_INCOMING_PARENT\n        );\n\n        const parentNodes = {};\n\n        targets.forEach(({ node: targetNode, exists }) => {\n          invariant(\n            targetNode.rules.canDrop(newParentNode, targetNode, nodeHelpers),\n            ERROR_MOVE_CANNOT_DROP\n          );\n\n          // Ignore other checking if the Node is new\n          if (!exists) {\n            return;\n          }\n\n          invariant(\n            !nodeHelpers(targetNode.id).isTopLevelNode(),\n            ERROR_MOVE_TOP_LEVEL_NODE\n          );\n\n          const targetDeepNodes = nodeHelpers(targetNode.id).descendants(true);\n\n          invariant(\n            !targetDeepNodes.includes(newParentNode.id) &&\n              newParentNode.id !== targetNode.id,\n            ERROR_MOVE_TO_DESCENDANT\n          );\n\n          const currentParentNode =\n            targetNode.data.parent && state.nodes[targetNode.data.parent];\n\n          invariant(\n            currentParentNode.data.isCanvas,\n            ERROR_MOVE_NONCANVAS_CHILD\n          );\n\n          invariant(\n            currentParentNode ||\n              (!currentParentNode && !state.nodes[targetNode.id]),\n            ERROR_DUPLICATE_NODEID\n          );\n\n          if (currentParentNode.id !== newParentNode.id) {\n            if (!parentNodes[currentParentNode.id]) {\n              parentNodes[currentParentNode.id] = [];\n            }\n\n            parentNodes[currentParentNode.id].push(targetNode);\n          }\n        });\n\n        Object.keys(parentNodes).forEach((parentNodeId) => {\n          const childNodes = parentNodes[parentNodeId];\n          const parentNode = state.nodes[parentNodeId];\n\n          invariant(\n            parentNode.rules.canMoveOut(childNodes, parentNode, nodeHelpers),\n            ERROR_MOVE_OUTGOING_PARENT\n          );\n        });\n\n        return true;\n      } catch (err) {\n        if (onError) {\n          onError(err);\n        }\n        return false;\n      }\n    },\n    toSerializedNode() {\n      return serializeNode(node.data, state.options.resolver);\n    },\n    toNodeTree(includeOnly?: 'linkedNodes' | 'childNodes') {\n      const nodes = [id, ...this.descendants(true, includeOnly)].reduce(\n        (accum, descendantId) => {\n          accum[descendantId] = nodeHelpers(descendantId).get();\n          return accum;\n        },\n        {}\n      );\n\n      return {\n        rootNodeId: id,\n        nodes,\n      };\n    },\n\n    /**\n     Deprecated NodeHelpers\n     **/\n\n    decendants(deep = false) {\n      deprecationWarning('query.node(id).decendants', {\n        suggest: 'query.node(id).descendants',\n      });\n      return this.descendants(deep);\n    },\n    isTopLevelCanvas() {\n      return !this.isRoot() && !node.data.parent;\n    },\n  };\n}\n","import { Node, NodeInfo, DropPosition } from '../interfaces';\n\nexport default function findPosition(\n  parent: Node,\n  dims: NodeInfo[],\n  posX: number,\n  posY: number\n) {\n  let result: DropPosition = {\n    parent,\n    index: 0,\n    where: 'before',\n  };\n\n  let leftLimit = 0,\n    xLimit = 0,\n    dimRight = 0,\n    yLimit = 0,\n    xCenter = 0,\n    yCenter = 0,\n    dimDown = 0;\n\n  // Each dim is: Top, Left, Height, Width\n  for (let i = 0, len = dims.length; i < len; i++) {\n    const dim = dims[i];\n\n    // Right position of the element. Left + Width\n    dimRight = dim.left + dim.outerWidth;\n    // Bottom position of the element. Top + Height\n    dimDown = dim.top + dim.outerHeight;\n    // X center position of the element. Left + (Width / 2)\n    xCenter = dim.left + dim.outerWidth / 2;\n    // Y center position of the element. Top + (Height / 2)\n    yCenter = dim.top + dim.outerHeight / 2;\n    // Skip if over the limits\n    if (\n      (xLimit && dim.left > xLimit) ||\n      (yLimit && yCenter >= yLimit) || // >= avoid issue with clearfixes\n      (leftLimit && dimRight < leftLimit)\n    )\n      continue;\n\n    result.index = i;\n    // If it's not in flow (like 'float' element)\n    if (!dim.inFlow) {\n      if (posY < dimDown) yLimit = dimDown;\n      //If x lefter than center\n      if (posX < xCenter) {\n        xLimit = xCenter;\n        result.where = 'before';\n      } else {\n        leftLimit = xCenter;\n        result.where = 'after';\n      }\n    } else {\n      // If y upper than center\n      if (posY < yCenter) {\n        result.where = 'before';\n        break;\n      } else result.where = 'after'; // After last element\n    }\n  }\n\n  return result;\n}\n","import { getRandomId as getRandomNodeId } from '@craftjs/utils';\nimport React from 'react';\n\nimport { Node, FreshNode, UserComponentConfig } from '../interfaces';\nimport {\n  defaultElementProps,\n  Element,\n  Canvas,\n  elementPropToNodeData,\n  deprecateCanvasComponent,\n} from '../nodes';\nimport { NodeProvider } from '../nodes/NodeContext';\n\nconst getNodeTypeName = (type: string | { name: string }) =>\n  typeof type == 'string' ? type : type.name;\n\nexport function createNode(\n  newNode: FreshNode,\n  normalize?: (node: Node) => void\n) {\n  let actualType = newNode.data.type as any;\n  let id = newNode.id || getRandomNodeId();\n\n  const node: Node = {\n    id,\n    _hydrationTimestamp: Date.now(),\n    data: {\n      type: actualType,\n      name: getNodeTypeName(actualType),\n      displayName: getNodeTypeName(actualType),\n      props: {},\n      custom: {},\n      parent: null,\n      isCanvas: false,\n      hidden: false,\n      nodes: [],\n      linkedNodes: {},\n      ...newNode.data,\n    },\n    info: {},\n    related: {},\n    events: {\n      selected: false,\n      dragged: false,\n      hovered: false,\n    },\n    rules: {\n      canDrag: () => true,\n      canDrop: () => true,\n      canMoveIn: () => true,\n      canMoveOut: () => true,\n    },\n    dom: null,\n  };\n\n  // @ts-ignore\n  if (node.data.type === Element || node.data.type === Canvas) {\n    const mergedProps = {\n      ...defaultElementProps,\n      ...node.data.props,\n    };\n\n    node.data.props = Object.keys(node.data.props).reduce((props, key) => {\n      if (Object.keys(defaultElementProps).includes(key)) {\n        // If a <Element /> specific props is found (ie: \"is\", \"canvas\")\n        // Replace the node.data with the value specified in the prop\n        node.data[elementPropToNodeData[key] || key] = mergedProps[key];\n      } else {\n        // Otherwise include the props in the node as usual\n        props[key] = node.data.props[key];\n      }\n\n      return props;\n    }, {});\n\n    actualType = node.data.type;\n    node.data.name = getNodeTypeName(actualType);\n    node.data.displayName = getNodeTypeName(actualType);\n\n    const usingDeprecatedCanvas = node.data.type === Canvas;\n    if (usingDeprecatedCanvas) {\n      node.data.isCanvas = true;\n      deprecateCanvasComponent();\n    }\n  }\n\n  if (normalize) {\n    normalize(node);\n  }\n\n  // TODO: use UserComponentConfig type\n  const userComponentConfig = actualType.craft as UserComponentConfig<any>;\n\n  if (userComponentConfig) {\n    node.data.displayName =\n      userComponentConfig.displayName ||\n      userComponentConfig.name ||\n      node.data.displayName;\n\n    node.data.props = {\n      ...(userComponentConfig.props || userComponentConfig.defaultProps || {}),\n      ...node.data.props,\n    };\n\n    node.data.custom = {\n      ...(userComponentConfig.custom || {}),\n      ...node.data.custom,\n    };\n\n    if (\n      userComponentConfig.isCanvas !== undefined &&\n      userComponentConfig.isCanvas !== null\n    ) {\n      node.data.isCanvas = userComponentConfig.isCanvas;\n    }\n\n    if (userComponentConfig.rules) {\n      Object.keys(userComponentConfig.rules).forEach((key) => {\n        if (['canDrag', 'canDrop', 'canMoveIn', 'canMoveOut'].includes(key)) {\n          node.rules[key] = userComponentConfig.rules[key];\n        }\n      });\n    }\n\n    if (userComponentConfig.related) {\n      const relatedNodeContext = {\n        id: node.id,\n        related: true,\n      };\n\n      Object.keys(userComponentConfig.related).forEach((comp) => {\n        node.related[comp] = (props) =>\n          React.createElement(\n            NodeProvider,\n            relatedNodeContext,\n            React.createElement(userComponentConfig.related[comp], props)\n          );\n      });\n    }\n\n    if (userComponentConfig.info) {\n      node.info = userComponentConfig.info;\n    }\n  }\n\n  return node;\n}\n","import { ERROR_DESERIALIZE_COMPONENT_NOT_IN_RESOLVER } from '@craftjs/utils';\nimport React from 'react';\nimport invariant from 'tiny-invariant';\n\nimport { resolveComponent } from './resolveComponent';\n\nimport {\n  NodeData,\n  SerializedNode,\n  ReducedComp,\n  ReduceCompType,\n} from '../interfaces';\nimport { Resolver } from '../interfaces';\nimport { Canvas } from '../nodes/Canvas';\n\ntype DeserialisedType = React.JSX.Element & { name: string };\n\nconst restoreType = (type: ReduceCompType, resolver: Resolver) =>\n  typeof type === 'object' && type.resolvedName\n    ? type.resolvedName === 'Canvas'\n      ? Canvas\n      : resolver[type.resolvedName]\n    : typeof type === 'string'\n    ? type\n    : null;\n\nexport const deserializeComp = (\n  data: ReducedComp,\n  resolver: Resolver,\n  index?: number\n): DeserialisedType | void => {\n  let { type, props } = data;\n\n  const main = restoreType(type, resolver);\n\n  if (!main) {\n    return;\n  }\n\n  props = Object.keys(props).reduce((result: Record<string, any>, key) => {\n    const prop = props[key];\n    if (prop === null || prop === undefined) {\n      result[key] = null;\n    } else if (typeof prop === 'object' && prop.resolvedName) {\n      result[key] = deserializeComp(prop, resolver);\n    } else if (key === 'children' && Array.isArray(prop)) {\n      result[key] = prop.map((child) => {\n        if (typeof child === 'string') {\n          return child;\n        }\n        return deserializeComp(child, resolver);\n      });\n    } else {\n      result[key] = prop;\n    }\n    return result;\n  }, {});\n\n  if (index) {\n    props.key = index;\n  }\n\n  const jsx = {\n    ...React.createElement(main, {\n      ...props,\n    }),\n  };\n\n  return {\n    ...jsx,\n    name: resolveComponent(resolver, jsx.type),\n  };\n};\n\nexport const deserializeNode = (\n  data: SerializedNode,\n  resolver: Resolver\n): Omit<NodeData, 'event'> => {\n  const { type: Comp, props: Props, ...nodeData } = data;\n\n  const isCompAnHtmlElement = Comp !== undefined && typeof Comp === 'string';\n  const isCompAUserComponent =\n    Comp !== undefined &&\n    (Comp as { resolvedName?: string }).resolvedName !== undefined;\n\n  invariant(\n    isCompAnHtmlElement || isCompAUserComponent,\n    ERROR_DESERIALIZE_COMPONENT_NOT_IN_RESOLVER.replace(\n      '%displayName%',\n      data.displayName\n    ).replace('%availableComponents%', Object.keys(resolver).join(', '))\n  );\n\n  const { type, name, props } = (deserializeComp(\n    data,\n    resolver\n  ) as unknown) as NodeData;\n\n  const { parent, custom, displayName, isCanvas, nodes, hidden } = nodeData;\n\n  const linkedNodes = nodeData.linkedNodes || nodeData._childCanvas;\n\n  return {\n    type,\n    name,\n    displayName: displayName || name,\n    props,\n    custom: custom || {},\n    isCanvas: !!isCanvas,\n    hidden: !!hidden,\n    parent,\n    linkedNodes: linkedNodes || {},\n    nodes: nodes || [],\n  };\n};\n","import { Node, NodeTree } from '../interfaces';\n\nconst mergeNodes = (rootNode: Node, childrenNodes: NodeTree[]) => {\n  if (childrenNodes.length < 1) {\n    return { [rootNode.id]: rootNode };\n  }\n  const nodes = childrenNodes.map(({ rootNodeId }) => rootNodeId);\n  const nodeWithChildren = { ...rootNode, data: { ...rootNode.data, nodes } };\n  const rootNodes = { [rootNode.id]: nodeWithChildren };\n  return childrenNodes.reduce((accum, tree) => {\n    const currentNode = tree.nodes[tree.rootNodeId];\n    return {\n      ...accum,\n      ...tree.nodes,\n      // set the parent id for the current node\n      [currentNode.id]: {\n        ...currentNode,\n        data: {\n          ...currentNode.data,\n          parent: rootNode.id,\n        },\n      },\n    };\n  }, rootNodes);\n};\n\nexport const mergeTrees = (\n  rootNode: Node,\n  childrenNodes: NodeTree[]\n): NodeTree => ({\n  rootNodeId: rootNode.id,\n  nodes: mergeNodes(rootNode, childrenNodes),\n});\n","import React, { Fragment } from 'react';\n\nimport { createNode } from './createNode';\n\nimport { Node } from '../interfaces';\n\nexport function parseNodeFromJSX(\n  jsx: React.ReactElement<any> | string,\n  normalize?: (node: Node, jsx: React.ReactElement<any>) => void\n) {\n  let element = jsx as React.ReactElement<any>;\n\n  if (typeof element === 'string') {\n    element = React.createElement(Fragment, {}, element) as React.ReactElement<\n      any\n    >;\n  }\n\n  let actualType = element.type as any;\n\n  return createNode(\n    {\n      data: {\n        type: actualType,\n        props: { ...element.props },\n      },\n    },\n    (node) => {\n      if (normalize) {\n        normalize(node, element);\n      }\n    }\n  );\n}\n","import {\n  QueryCallbacksFor,\n  ERROR_NOT_IN_RESOLVER,\n  getDOMInfo,\n  deprecationWarning,\n  DEPRECATED_ROOT_NODE,\n  ROOT_NODE,\n} from '@craftjs/utils';\nimport React from 'react';\nimport invariant from 'tiny-invariant';\n\nimport { EventHelpers } from './EventHelpers';\nimport { NodeHelpers } from './NodeHelpers';\n\nimport findPosition from '../events/findPosition';\nimport {\n  NodeId,\n  EditorState,\n  Indicator,\n  Node,\n  Options,\n  NodeEventTypes,\n  NodeInfo,\n  NodeSelector,\n  NodeTree,\n  SerializedNodes,\n  SerializedNode,\n  FreshNode,\n} from '../interfaces';\nimport { createNode } from '../utils/createNode';\nimport { deserializeNode } from '../utils/deserializeNode';\nimport { fromEntries } from '../utils/fromEntries';\nimport { getNodesFromSelector } from '../utils/getNodesFromSelector';\nimport { mergeTrees } from '../utils/mergeTrees';\nimport { parseNodeFromJSX } from '../utils/parseNodeFromJSX';\nimport { resolveComponent } from '../utils/resolveComponent';\n\nexport function QueryMethods(state: EditorState) {\n  const options = state && state.options;\n\n  const _: () => QueryCallbacksFor<typeof QueryMethods> = () =>\n    QueryMethods(state) as any;\n\n  return {\n    /**\n     * Determine the best possible location to drop the source Node relative to the target Node\n     *\n     * TODO: replace with Positioner.computeIndicator();\n     */\n    getDropPlaceholder: (\n      source: NodeSelector,\n      target: NodeId,\n      pos: { x: number; y: number },\n      nodesToDOM: (node: Node) => HTMLElement = (node) =>\n        state.nodes[node.id].dom\n    ) => {\n      const targetNode = state.nodes[target],\n        isTargetCanvas = _().node(targetNode.id).isCanvas();\n\n      const targetParent = isTargetCanvas\n        ? targetNode\n        : state.nodes[targetNode.data.parent];\n\n      if (!targetParent) return;\n\n      const targetParentNodes = targetParent.data.nodes || [];\n\n      const dimensionsInContainer = targetParentNodes\n        ? targetParentNodes.reduce((result, id: NodeId) => {\n            const dom = nodesToDOM(state.nodes[id]);\n            if (dom) {\n              const info: NodeInfo = {\n                id,\n                ...getDOMInfo(dom),\n              };\n\n              result.push(info);\n            }\n            return result;\n          }, [] as NodeInfo[])\n        : [];\n\n      const dropAction = findPosition(\n        targetParent,\n        dimensionsInContainer,\n        pos.x,\n        pos.y\n      );\n      const currentNode =\n        targetParentNodes.length &&\n        state.nodes[targetParentNodes[dropAction.index]];\n\n      const output: Indicator = {\n        placement: {\n          ...dropAction,\n          currentNode,\n        },\n        error: null,\n      };\n\n      const sourceNodes = getNodesFromSelector(state.nodes, source);\n\n      sourceNodes.forEach(({ node, exists }) => {\n        // If source Node is already in the editor, check if it's draggable\n        if (exists) {\n          _()\n            .node(node.id)\n            .isDraggable((err) => (output.error = err));\n        }\n      });\n\n      // Check if source Node is droppable in target\n      _()\n        .node(targetParent.id)\n        .isDroppable(source, (err) => (output.error = err));\n\n      return output;\n    },\n\n    /**\n     * Get the current Editor options\n     */\n    getOptions(): Options {\n      return options;\n    },\n\n    getNodes() {\n      return state.nodes;\n    },\n\n    /**\n     * Helper methods to describe the specified Node\n     * @param id\n     */\n    node(id: NodeId) {\n      return NodeHelpers(state, id);\n    },\n\n    /**\n     * Returns all the `nodes` in a serialized format\n     */\n    getSerializedNodes(): SerializedNodes {\n      const nodePairs = Object.keys(state.nodes).map((id: NodeId) => [\n        id,\n        this.node(id).toSerializedNode(),\n      ]);\n      return fromEntries(nodePairs);\n    },\n\n    getEvent(eventType: NodeEventTypes) {\n      return EventHelpers(state, eventType);\n    },\n\n    /**\n     * Retrieve the JSON representation of the editor's Nodes\n     */\n    serialize(): string {\n      return JSON.stringify(this.getSerializedNodes());\n    },\n\n    parseReactElement: (reactElement: React.ReactElement<any>) => ({\n      toNodeTree(\n        normalize?: (node: Node, jsx: React.ReactElement<any>) => void\n      ): NodeTree {\n        let node = parseNodeFromJSX(reactElement, (node, jsx) => {\n          const name = resolveComponent(state.options.resolver, node.data.type);\n\n          node.data.displayName = node.data.displayName || name;\n          node.data.name = name;\n\n          if (normalize) {\n            normalize(node, jsx);\n          }\n        });\n\n        let childrenNodes: NodeTree[] = [];\n\n        if (reactElement.props && reactElement.props.children) {\n          childrenNodes = React.Children.toArray(\n            reactElement.props.children\n          ).reduce<NodeTree[]>((accum, child: any) => {\n            if (React.isValidElement(child)) {\n              accum.push(_().parseReactElement(child).toNodeTree(normalize));\n            }\n            return accum;\n          }, []);\n        }\n\n        return mergeTrees(node, childrenNodes);\n      },\n    }),\n\n    parseSerializedNode: (serializedNode: SerializedNode) => ({\n      toNode(normalize?: (node: Node) => void): Node {\n        const data = deserializeNode(serializedNode, state.options.resolver);\n        invariant(data.type, ERROR_NOT_IN_RESOLVER);\n\n        const id = typeof normalize === 'string' && normalize;\n\n        if (id) {\n          deprecationWarning(`query.parseSerializedNode(...).toNode(id)`, {\n            suggest: `query.parseSerializedNode(...).toNode(node => node.id = id)`,\n          });\n        }\n\n        return _()\n          .parseFreshNode({\n            ...(id ? { id } : {}),\n            data,\n          })\n          .toNode(!id && normalize);\n      },\n    }),\n\n    parseFreshNode: (node: FreshNode) => ({\n      toNode(normalize?: (node: Node) => void): Node {\n        return createNode(node, (node) => {\n          if (node.data.parent === DEPRECATED_ROOT_NODE) {\n            node.data.parent = ROOT_NODE;\n          }\n\n          const name = resolveComponent(state.options.resolver, node.data.type);\n          invariant(name !== null, ERROR_NOT_IN_RESOLVER);\n          node.data.displayName = node.data.displayName || name;\n          node.data.name = name;\n\n          if (normalize) {\n            normalize(node);\n          }\n        });\n      },\n    }),\n\n    createNode(reactElement: React.ReactElement, extras?: any) {\n      deprecationWarning(`query.createNode(${reactElement})`, {\n        suggest: `query.parseReactElement(${reactElement}).toNodeTree()`,\n      });\n\n      const tree = this.parseReactElement(reactElement).toNodeTree();\n\n      const node = tree.nodes[tree.rootNodeId];\n\n      if (!extras) {\n        return node;\n      }\n\n      if (extras.id) {\n        node.id = extras.id;\n      }\n\n      if (extras.data) {\n        node.data = {\n          ...node.data,\n          ...extras.data,\n        };\n      }\n\n      return node;\n    },\n\n    getState() {\n      return state;\n    },\n  };\n}\n","import { DerivedEventHandlers, EventHandlers } from '@craftjs/utils';\n\nimport { EditorStore } from '../editor/store';\nimport { NodeId, NodeTree } from '../interfaces/nodes';\n\nexport interface CreateHandlerOptions {\n  onCreate: (nodeTree: NodeTree) => void;\n}\n\nexport class CoreEventHandlers<O = {}> extends EventHandlers<\n  { store: EditorStore; removeHoverOnMouseleave: boolean } & O\n> {\n  handlers() {\n    return {\n      connect: (el: HTMLElement, id: NodeId) => {},\n      select: (el: HTMLElement, id: NodeId) => {},\n      hover: (el: HTMLElement, id: NodeId) => {},\n      drag: (el: HTMLElement, id: NodeId) => {},\n      drop: (el: HTMLElement, id: NodeId) => {},\n      create: (\n        el: HTMLElement,\n        UserElement: React.ReactElement | (() => NodeTree | React.ReactElement),\n        options?: Partial<CreateHandlerOptions>\n      ) => {},\n    };\n  }\n}\n\nexport abstract class DerivedCoreEventHandlers<\n  O = {}\n> extends DerivedEventHandlers<CoreEventHandlers, O> {}\n","import { getDOMInfo, ROOT_NODE } from '@craftjs/utils';\n\nimport findPosition from './findPosition';\n\nimport { EditorStore } from '../editor/store';\nimport {\n  DragTarget,\n  DropPosition,\n  Indicator,\n  Node,\n  NodeId,\n  NodeInfo,\n  NodeSelectorWrapper,\n} from '../interfaces';\nimport { getNodesFromSelector } from '../utils/getNodesFromSelector';\n\n// Hack: to trigger dragend event immediate\n// Otherwise we would have to wait until the native animation is completed before we can actually drop an block\nconst documentDragoverEventHandler = (e: DragEvent) => {\n  e.preventDefault();\n};\n\n/**\n * Positioner is responsible for computing the drop Indicator during a sequence of drag-n-drop events\n */\nexport class Positioner {\n  static BORDER_OFFSET = 10;\n\n  // Current Node being hovered on\n  private currentDropTargetId: NodeId | null;\n  // Current closest Canvas Node relative to the currentDropTarget\n  private currentDropTargetCanvasAncestorId: NodeId | null;\n\n  private currentIndicator: Indicator | null = null;\n\n  private currentTargetId: NodeId | null;\n  private currentTargetChildDimensions: NodeInfo[] | null;\n\n  private dragError: string | null;\n  private draggedNodes: NodeSelectorWrapper[];\n\n  private onScrollListener: (e: Event) => void;\n\n  constructor(readonly store: EditorStore, readonly dragTarget: DragTarget) {\n    this.currentDropTargetId = null;\n    this.currentDropTargetCanvasAncestorId = null;\n\n    this.currentTargetId = null;\n    this.currentTargetChildDimensions = null;\n\n    this.currentIndicator = null;\n\n    this.dragError = null;\n    this.draggedNodes = this.getDraggedNodes();\n\n    this.validateDraggedNodes();\n\n    this.onScrollListener = this.onScroll.bind(this);\n    window.addEventListener('scroll', this.onScrollListener, true);\n    window.addEventListener('dragover', documentDragoverEventHandler, false);\n  }\n\n  cleanup() {\n    window.removeEventListener('scroll', this.onScrollListener, true);\n    window.removeEventListener('dragover', documentDragoverEventHandler, false);\n  }\n\n  private onScroll(e: Event) {\n    const scrollBody = e.target;\n    const rootNode = this.store.query.node(ROOT_NODE).get();\n\n    // Clear the currentTargetChildDimensions if the user has scrolled\n    // Because we will have to recompute new dimensions relative to the new scroll pos\n    const shouldClearChildDimensionsCache =\n      scrollBody instanceof Element &&\n      rootNode &&\n      rootNode.dom &&\n      scrollBody.contains(rootNode.dom);\n\n    if (!shouldClearChildDimensionsCache) {\n      return;\n    }\n\n    this.currentTargetChildDimensions = null;\n  }\n\n  private getDraggedNodes() {\n    if (this.dragTarget.type === 'new') {\n      return getNodesFromSelector(\n        this.store.query.getNodes(),\n        this.dragTarget.tree.nodes[this.dragTarget.tree.rootNodeId]\n      );\n    }\n\n    return getNodesFromSelector(\n      this.store.query.getNodes(),\n      this.dragTarget.nodes\n    );\n  }\n\n  // Check if the elements being dragged are allowed to be dragged\n  private validateDraggedNodes() {\n    // We don't need to check for dragTarget.type = \"new\" because those nodes are not yet in the state (ie: via the .create() connector)\n    if (this.dragTarget.type === 'new') {\n      return;\n    }\n\n    this.draggedNodes.forEach(({ node, exists }) => {\n      if (!exists) {\n        return;\n      }\n\n      this.store.query.node(node.id).isDraggable((err) => {\n        this.dragError = err;\n      });\n    });\n  }\n\n  private isNearBorders(\n    domInfo: ReturnType<typeof getDOMInfo>,\n    x: number,\n    y: number\n  ) {\n    const { top, bottom, left, right } = domInfo;\n\n    if (\n      top + Positioner.BORDER_OFFSET > y ||\n      bottom - Positioner.BORDER_OFFSET < y ||\n      left + Positioner.BORDER_OFFSET > x ||\n      right - Positioner.BORDER_OFFSET < x\n    ) {\n      return true;\n    }\n\n    return false;\n  }\n\n  private isDiff(newPosition: DropPosition) {\n    if (\n      this.currentIndicator &&\n      this.currentIndicator.placement.parent.id === newPosition.parent.id &&\n      this.currentIndicator.placement.index === newPosition.index &&\n      this.currentIndicator.placement.where === newPosition.where\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Get dimensions of every child Node in the specified parent Node\n   */\n  private getChildDimensions(newParentNode: Node) {\n    // Use previously computed child dimensions if newParentNode is the same as the previous one\n    const existingTargetChildDimensions = this.currentTargetChildDimensions;\n    if (\n      this.currentTargetId === newParentNode.id &&\n      existingTargetChildDimensions\n    ) {\n      return existingTargetChildDimensions;\n    }\n\n    return newParentNode.data.nodes.reduce((result, id: NodeId) => {\n      const dom = this.store.query.node(id).get().dom;\n\n      if (dom) {\n        result.push({\n          id,\n          ...getDOMInfo(dom),\n        });\n      }\n\n      return result;\n    }, [] as NodeInfo[]);\n  }\n\n  /**\n   * Get closest Canvas node relative to the dropTargetId\n   * Return dropTargetId if it itself is a Canvas node\n   *\n   * In most cases it will be the dropTarget itself or its immediate parent.\n   * We typically only need to traverse 2 levels or more if the dropTarget is a linked node\n   *\n   * TODO: We should probably have some special rules to handle linked nodes\n   */\n  private getCanvasAncestor(dropTargetId: NodeId) {\n    // If the dropTargetId is the same as the previous one\n    // Return the canvas ancestor node that we found previuously\n    if (\n      dropTargetId === this.currentDropTargetId &&\n      this.currentDropTargetCanvasAncestorId\n    ) {\n      const node = this.store.query\n        .node(this.currentDropTargetCanvasAncestorId)\n        .get();\n\n      if (node) {\n        return node;\n      }\n    }\n\n    const getCanvas = (nodeId: NodeId): Node => {\n      const node = this.store.query.node(nodeId).get();\n\n      if (node && node.data.isCanvas) {\n        return node;\n      }\n\n      if (!node.data.parent) {\n        return null;\n      }\n\n      return getCanvas(node.data.parent);\n    };\n\n    return getCanvas(dropTargetId);\n  }\n\n  /**\n   * Compute a new Indicator object based on the dropTarget and x,y coords\n   * Returns null if theres no change from the previous Indicator\n   */\n  computeIndicator(dropTargetId: NodeId, x: number, y: number): Indicator {\n    let newParentNode = this.getCanvasAncestor(dropTargetId);\n\n    if (!newParentNode) {\n      return;\n    }\n\n    this.currentDropTargetId = dropTargetId;\n    this.currentDropTargetCanvasAncestorId = newParentNode.id;\n\n    // Get parent if we're hovering at the border of the current node\n    if (\n      newParentNode.data.parent &&\n      this.isNearBorders(getDOMInfo(newParentNode.dom), x, y) &&\n      // Ignore if linked node because there's won't be an adjacent sibling anyway\n      !this.store.query.node(newParentNode.id).isLinkedNode()\n    ) {\n      newParentNode = this.store.query.node(newParentNode.data.parent).get();\n    }\n\n    if (!newParentNode) {\n      return;\n    }\n\n    this.currentTargetChildDimensions = this.getChildDimensions(newParentNode);\n    this.currentTargetId = newParentNode.id;\n\n    const position = findPosition(\n      newParentNode,\n      this.currentTargetChildDimensions,\n      x,\n      y\n    );\n\n    // Ignore if the position is similar as the previous one\n    if (!this.isDiff(position)) {\n      return;\n    }\n\n    let error = this.dragError;\n\n    // Last thing to check for is if the dragged nodes can be dropped in the target area\n    if (!error) {\n      this.store.query.node(newParentNode.id).isDroppable(\n        this.draggedNodes.map((sourceNode) => sourceNode.node),\n        (dropError) => {\n          error = dropError;\n        }\n      );\n    }\n\n    const currentNodeId = newParentNode.data.nodes[position.index];\n    const currentNode =\n      currentNodeId && this.store.query.node(currentNodeId).get();\n\n    this.currentIndicator = {\n      placement: {\n        ...position,\n        currentNode,\n      },\n      error,\n    };\n\n    return this.currentIndicator;\n  }\n\n  getIndicator() {\n    return this.currentIndicator;\n  }\n}\n","// Works partially with Linux (except on Chrome)\n// We'll need an alternate way to create drag shadows\nexport const createShadow = (\n  e: DragEvent,\n  shadowsToCreate: HTMLElement[],\n  forceSingleShadow: boolean = false\n) => {\n  if (shadowsToCreate.length === 1 || forceSingleShadow) {\n    const { width, height } = shadowsToCreate[0].getBoundingClientRect();\n    const shadow = shadowsToCreate[0].cloneNode(true) as HTMLElement;\n\n    shadow.style.position = `absolute`;\n    shadow.style.left = `-100%`;\n    shadow.style.top = `-100%`;\n    shadow.style.width = `${width}px`;\n    shadow.style.height = `${height}px`;\n    shadow.style.pointerEvents = 'none';\n    shadow.classList.add('drag-shadow');\n\n    document.body.appendChild(shadow);\n    e.dataTransfer.setDragImage(shadow, 0, 0);\n\n    return shadow;\n  }\n\n  /**\n   * If there's supposed to be multiple drag shadows, we will create a single container div to store them\n   * That container will be used as the drag shadow for the current drag event\n   */\n  const container = document.createElement('div');\n  container.style.position = 'absolute';\n  container.style.left = '-100%';\n  container.style.top = `-100%`;\n  container.style.width = '100%';\n  container.style.height = '100%';\n  container.style.pointerEvents = 'none';\n  container.classList.add('drag-shadow-container');\n\n  shadowsToCreate.forEach((dom) => {\n    const { width, height, top, left } = dom.getBoundingClientRect();\n    const shadow = dom.cloneNode(true) as HTMLElement;\n\n    shadow.style.position = `absolute`;\n    shadow.style.left = `${left}px`;\n    shadow.style.top = `${top}px`;\n    shadow.style.width = `${width}px`;\n    shadow.style.height = `${height}px`;\n    shadow.classList.add('drag-shadow');\n\n    container.appendChild(shadow);\n  });\n\n  document.body.appendChild(container);\n  e.dataTransfer.setDragImage(container, e.clientX, e.clientY);\n\n  return container;\n};\n","import { isChromium, isLinux } from '@craftjs/utils';\nimport isFunction from 'lodash/isFunction';\nimport React from 'react';\n\nimport { CoreEventHandlers, CreateHandlerOptions } from './CoreEventHandlers';\nimport { Positioner } from './Positioner';\nimport { createShadow } from './createShadow';\n\nimport { Indicator, NodeId, DragTarget, NodeTree } from '../interfaces';\n\nexport type DefaultEventHandlersOptions = {\n  isMultiSelectEnabled: (e: MouseEvent) => boolean;\n  removeHoverOnMouseleave: boolean;\n};\n\n/**\n * Specifies Editor-wide event handlers and connectors\n */\nexport class DefaultEventHandlers<O = {}> extends CoreEventHandlers<\n  DefaultEventHandlersOptions & O\n> {\n  /**\n   * Note: Multiple drag shadows (ie: via multiselect in v0.2 and higher) do not look good on Linux Chromium due to way it renders drag shadows in general,\n   * so will have to fallback to the single shadow approach above for the time being\n   * see: https://bugs.chromium.org/p/chromium/issues/detail?id=550999\n   */\n  static forceSingleDragShadow = isChromium() && isLinux();\n\n  draggedElementShadow: HTMLElement;\n  dragTarget: DragTarget;\n  positioner: Positioner | null = null;\n  currentSelectedElementIds = [];\n\n  onDisable() {\n    this.options.store.actions.clearEvents();\n  }\n\n  handlers() {\n    const store = this.options.store;\n\n    return {\n      connect: (el: HTMLElement, id: NodeId) => {\n        store.actions.setDOM(id, el);\n\n        return this.reflect((connectors) => {\n          connectors.select(el, id);\n          connectors.hover(el, id);\n          connectors.drop(el, id);\n        });\n      },\n      select: (el: HTMLElement, id: NodeId) => {\n        const unbindOnMouseDown = this.addCraftEventListener(\n          el,\n          'mousedown',\n          (e) => {\n            e.craft.stopPropagation();\n\n            let newSelectedElementIds = [];\n\n            if (id) {\n              const { query } = store;\n              const selectedElementIds = query.getEvent('selected').all();\n              const isMultiSelect = this.options.isMultiSelectEnabled(e);\n\n              /**\n               * Retain the previously select elements if the multi-select condition is enabled\n               * or if the currentNode is already selected\n               *\n               * so users can just click to drag the selected elements around without holding the multi-select key\n               */\n\n              if (isMultiSelect || selectedElementIds.includes(id)) {\n                newSelectedElementIds = selectedElementIds.filter(\n                  (selectedId) => {\n                    const descendants = query\n                      .node(selectedId)\n                      .descendants(true);\n                    const ancestors = query.node(selectedId).ancestors(true);\n\n                    // Deselect ancestors/descendants\n                    if (descendants.includes(id) || ancestors.includes(id)) {\n                      return false;\n                    }\n\n                    return true;\n                  }\n                );\n              }\n\n              if (!newSelectedElementIds.includes(id)) {\n                newSelectedElementIds.push(id);\n              }\n            }\n\n            store.actions.setNodeEvent('selected', newSelectedElementIds);\n          }\n        );\n\n        const unbindOnClick = this.addCraftEventListener(el, 'click', (e) => {\n          e.craft.stopPropagation();\n\n          const { query } = store;\n          const selectedElementIds = query.getEvent('selected').all();\n\n          const isMultiSelect = this.options.isMultiSelectEnabled(e);\n          const isNodeAlreadySelected = this.currentSelectedElementIds.includes(\n            id\n          );\n\n          let newSelectedElementIds = [...selectedElementIds];\n\n          if (isMultiSelect && isNodeAlreadySelected) {\n            newSelectedElementIds.splice(newSelectedElementIds.indexOf(id), 1);\n            store.actions.setNodeEvent('selected', newSelectedElementIds);\n          } else if (!isMultiSelect && selectedElementIds.length > 1) {\n            newSelectedElementIds = [id];\n            store.actions.setNodeEvent('selected', newSelectedElementIds);\n          }\n\n          this.currentSelectedElementIds = newSelectedElementIds;\n        });\n\n        return () => {\n          unbindOnMouseDown();\n          unbindOnClick();\n        };\n      },\n      hover: (el: HTMLElement, id: NodeId) => {\n        const unbindMouseover = this.addCraftEventListener(\n          el,\n          'mouseover',\n          (e) => {\n            e.craft.stopPropagation();\n            store.actions.setNodeEvent('hovered', id);\n          }\n        );\n\n        let unbindMouseleave: (() => void) | null = null;\n\n        if (this.options.removeHoverOnMouseleave) {\n          unbindMouseleave = this.addCraftEventListener(\n            el,\n            'mouseleave',\n            (e) => {\n              e.craft.stopPropagation();\n              store.actions.setNodeEvent('hovered', null);\n            }\n          );\n        }\n\n        return () => {\n          unbindMouseover();\n\n          if (!unbindMouseleave) {\n            return;\n          }\n\n          unbindMouseleave();\n        };\n      },\n      drop: (el: HTMLElement, targetId: NodeId) => {\n        const unbindDragOver = this.addCraftEventListener(\n          el,\n          'dragover',\n          (e) => {\n            e.craft.stopPropagation();\n            e.preventDefault();\n\n            if (!this.positioner) {\n              return;\n            }\n\n            const indicator = this.positioner.computeIndicator(\n              targetId,\n              e.clientX,\n              e.clientY\n            );\n\n            if (!indicator) {\n              return;\n            }\n\n            store.actions.setIndicator(indicator);\n          }\n        );\n\n        const unbindDragEnter = this.addCraftEventListener(\n          el,\n          'dragenter',\n          (e) => {\n            e.craft.stopPropagation();\n            e.preventDefault();\n          }\n        );\n\n        return () => {\n          unbindDragEnter();\n          unbindDragOver();\n        };\n      },\n      drag: (el: HTMLElement, id: NodeId) => {\n        if (!store.query.node(id).isDraggable()) {\n          return () => {};\n        }\n\n        el.setAttribute('draggable', 'true');\n\n        const unbindDragStart = this.addCraftEventListener(\n          el,\n          'dragstart',\n          (e) => {\n            e.craft.stopPropagation();\n\n            const { query, actions } = store;\n\n            let selectedElementIds = query.getEvent('selected').all();\n\n            const isMultiSelect = this.options.isMultiSelectEnabled(e);\n            const isNodeAlreadySelected = this.currentSelectedElementIds.includes(\n              id\n            );\n\n            if (!isNodeAlreadySelected) {\n              if (isMultiSelect) {\n                selectedElementIds = [...selectedElementIds, id];\n              } else {\n                selectedElementIds = [id];\n              }\n              store.actions.setNodeEvent('selected', selectedElementIds);\n            }\n\n            actions.setNodeEvent('dragged', selectedElementIds);\n\n            const selectedDOMs = selectedElementIds.map(\n              (id) => query.node(id).get().dom\n            );\n\n            this.draggedElementShadow = createShadow(\n              e,\n              selectedDOMs,\n              DefaultEventHandlers.forceSingleDragShadow\n            );\n\n            this.dragTarget = {\n              type: 'existing',\n              nodes: selectedElementIds,\n            };\n\n            this.positioner = new Positioner(\n              this.options.store,\n              this.dragTarget\n            );\n          }\n        );\n\n        const unbindDragEnd = this.addCraftEventListener(el, 'dragend', (e) => {\n          e.craft.stopPropagation();\n\n          this.dropElement((dragTarget, indicator) => {\n            if (dragTarget.type === 'new') {\n              return;\n            }\n\n            const index =\n              indicator.placement.index +\n              (indicator.placement.where === 'after' ? 1 : 0);\n\n            store.actions.move(\n              dragTarget.nodes,\n              indicator.placement.parent.id,\n              index\n            );\n          });\n        });\n\n        return () => {\n          el.setAttribute('draggable', 'false');\n          unbindDragStart();\n          unbindDragEnd();\n        };\n      },\n      create: (\n        el: HTMLElement,\n        userElement: React.ReactElement | (() => NodeTree | React.ReactElement),\n        options?: Partial<CreateHandlerOptions>\n      ) => {\n        el.setAttribute('draggable', 'true');\n\n        const unbindDragStart = this.addCraftEventListener(\n          el,\n          'dragstart',\n          (e) => {\n            e.craft.stopPropagation();\n            let tree;\n            if (typeof userElement === 'function') {\n              const result = userElement();\n              if (React.isValidElement(result)) {\n                tree = store.query.parseReactElement(result).toNodeTree();\n              } else {\n                tree = result;\n              }\n            } else {\n              tree = store.query.parseReactElement(userElement).toNodeTree();\n            }\n\n            const dom = e.currentTarget as HTMLElement;\n            this.draggedElementShadow = createShadow(\n              e,\n              [dom],\n              DefaultEventHandlers.forceSingleDragShadow\n            );\n            this.dragTarget = {\n              type: 'new',\n              tree,\n            };\n\n            this.positioner = new Positioner(\n              this.options.store,\n              this.dragTarget\n            );\n          }\n        );\n\n        const unbindDragEnd = this.addCraftEventListener(el, 'dragend', (e) => {\n          e.craft.stopPropagation();\n          this.dropElement((dragTarget, indicator) => {\n            if (dragTarget.type === 'existing') {\n              return;\n            }\n\n            const index =\n              indicator.placement.index +\n              (indicator.placement.where === 'after' ? 1 : 0);\n            store.actions.addNodeTree(\n              dragTarget.tree,\n              indicator.placement.parent.id,\n              index\n            );\n\n            if (options && isFunction(options.onCreate)) {\n              options.onCreate(dragTarget.tree);\n            }\n          });\n        });\n\n        return () => {\n          el.removeAttribute('draggable');\n          unbindDragStart();\n          unbindDragEnd();\n        };\n      },\n    };\n  }\n\n  private dropElement(\n    onDropNode: (dragTarget: DragTarget, placement: Indicator) => void\n  ) {\n    const store = this.options.store;\n\n    if (!this.positioner) {\n      return;\n    }\n\n    const draggedElementShadow = this.draggedElementShadow;\n\n    const indicator = this.positioner.getIndicator();\n\n    if (this.dragTarget && indicator && !indicator.error) {\n      onDropNode(this.dragTarget, indicator);\n    }\n\n    if (draggedElementShadow) {\n      draggedElementShadow.parentNode.removeChild(draggedElementShadow);\n      this.draggedElementShadow = null;\n    }\n\n    this.dragTarget = null;\n\n    store.actions.setIndicator(null);\n    store.actions.setNodeEvent('dragged', null);\n    this.positioner.cleanup();\n\n    this.positioner = null;\n  }\n}\n","import { DropPosition, DOMInfo } from '../interfaces';\n\nexport default function movePlaceholder(\n  pos: DropPosition,\n  canvasDOMInfo: DOMInfo, // which canvas is cursor at\n  bestTargetDomInfo: DOMInfo | null, // closest element in canvas (null if canvas is empty)\n  thickness: number = 2\n): {\n  top: string;\n  left: string;\n  width: string;\n  height: string;\n  mode: 'line' | 'block';\n} {\n  let t = 0,\n    l = 0,\n    w = 0,\n    h = 0,\n    where = pos.where;\n\n  let mode: 'line' | 'block' = 'line';\n  const elDim = bestTargetDomInfo;\n\n  // Show block area for empty containers or when dropping into container\n  if (!elDim) {\n    mode = 'block';\n    if (canvasDOMInfo) {\n      t = canvasDOMInfo.top + canvasDOMInfo.padding.top;\n      l = canvasDOMInfo.left + canvasDOMInfo.padding.left;\n      w =\n        canvasDOMInfo.outerWidth -\n        canvasDOMInfo.padding.right -\n        canvasDOMInfo.padding.left -\n        canvasDOMInfo.margin.left -\n        canvasDOMInfo.margin.right;\n      h =\n        canvasDOMInfo.outerHeight -\n        canvasDOMInfo.padding.top -\n        canvasDOMInfo.padding.bottom -\n        canvasDOMInfo.margin.top -\n        canvasDOMInfo.margin.bottom;\n\n      // Minimum height for better visibility\n      h = Math.max(h, 40);\n    }\n  } else {\n    // Line indicator for before/after\n    mode = 'line';\n    // If it's not in flow (like 'float' element)\n    if (!elDim.inFlow) {\n      w = thickness;\n      h = elDim.outerHeight;\n      t = elDim.top;\n      l = where === 'before' ? elDim.left : elDim.left + elDim.outerWidth;\n    } else {\n      w = elDim.outerWidth;\n      h = thickness;\n      t = where === 'before' ? elDim.top : elDim.bottom;\n      l = elDim.left;\n    }\n  }\n\n  return {\n    top: `${t}px`,\n    left: `${l}px`,\n    width: `${w}px`,\n    height: `${h}px`,\n    mode,\n  };\n}\n","import { RenderIndicator, getDOMInfo } from '@craftjs/utils';\nimport React, { useEffect } from 'react';\n\nimport { useEventHandler } from './EventContext';\nimport movePlaceholder from './movePlaceholder';\n\nimport { useInternalEditor } from '../editor/useInternalEditor';\n\nexport const RenderEditorIndicator = () => {\n  const { indicator, indicatorOptions, enabled } = useInternalEditor(\n    (state) => ({\n      indicator: state.indicator,\n      indicatorOptions: state.options.indicator,\n      enabled: state.options.enabled,\n    })\n  );\n\n  const handler = useEventHandler();\n\n  useEffect(() => {\n    if (!handler) {\n      return;\n    }\n\n    if (!enabled) {\n      handler.disable();\n      return;\n    }\n\n    handler.enable();\n  }, [enabled, handler]);\n\n  if (!indicator) {\n    return null;\n  }\n\n  const placeholderInfo = movePlaceholder(\n    indicator.placement,\n    getDOMInfo(indicator.placement.parent.dom),\n    indicator.placement.currentNode &&\n      getDOMInfo(indicator.placement.currentNode.dom),\n    indicatorOptions.thickness\n  );\n\n  const isBlockMode = placeholderInfo.mode === 'block';\n  const baseColor = indicator.error\n    ? indicatorOptions.error\n    : indicatorOptions.success;\n\n  return (\n    <RenderIndicator\n      className={indicatorOptions.className}\n      style={{\n        top: placeholderInfo.top,\n        left: placeholderInfo.left,\n        width: placeholderInfo.width,\n        height: placeholderInfo.height,\n        // Apply different styles based on mode\n        ...(isBlockMode\n          ? {\n              // Block area styles - subtle outline with corner accents\n              backgroundColor: `${baseColor}08`, // 08 = ~3% opacity (very subtle)\n              border: `2px solid ${baseColor}`,\n              borderRadius: '6px',\n              boxSizing: 'border-box',\n              pointerEvents: 'none',\n              // Add subtle shadow for depth\n              boxShadow: `0 0 0 4px ${baseColor}10, inset 0 0 20px ${baseColor}15`,\n              // Smooth transition\n              transition: 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)',\n            }\n          : {\n              // Line styles (existing behavior)\n              backgroundColor: baseColor,\n              borderWidth: 0,\n            }),\n        transition: indicatorOptions.transition || '0.2s ease-in',\n        ...(indicatorOptions.style ?? {}),\n      }}\n      parentDom={indicator.placement.parent.dom}\n    />\n  );\n};\n","import React, { useContext, useMemo } from 'react';\n\nimport { EventHandlerContext } from './EventContext';\nimport { RenderEditorIndicator } from './RenderEditorIndicator';\n\nimport { EditorContext } from '../editor/EditorContext';\n\ntype EventsProps = {\n  children?: React.ReactNode;\n};\n\nexport const Events = ({ children }: EventsProps) => {\n  const store = useContext(EditorContext);\n\n  const handler = useMemo(() => store.query.getOptions().handlers(store), [\n    store,\n  ]);\n\n  if (!handler) {\n    return null;\n  }\n\n  return (\n    <EventHandlerContext.Provider value={handler}>\n      <RenderEditorIndicator />\n      {children}\n    </EventHandlerContext.Provider>\n  );\n};\n","import {\n  useMethods,\n  SubscriberAndCallbacksFor,\n  PatchListener,\n} from '@craftjs/utils';\n\nimport { ActionMethods } from './actions';\nimport { QueryMethods } from './query';\n\nimport { DefaultEventHandlers } from '../events';\nimport { EditorState, Options, NodeEventTypes, NodeId } from '../interfaces';\n\nexport const editorInitialState: EditorState = {\n  nodes: {},\n  events: {\n    dragged: new Set<NodeId>(),\n    selected: new Set<NodeId>(),\n    hovered: new Set<NodeId>(),\n  },\n  indicator: null,\n  options: {\n    onNodesChange: () => null,\n    onRender: ({ render }) => render,\n    onBeforeMoveEnd: () => null,\n    resolver: {},\n    enabled: true,\n    indicator: {\n      error: 'red',\n      success: 'rgb(98, 196, 98)',\n    },\n    handlers: (store) =>\n      new DefaultEventHandlers({\n        store,\n        removeHoverOnMouseleave: false,\n        isMultiSelectEnabled: (e: MouseEvent) => !!e.metaKey,\n      }),\n    normalizeNodes: () => {},\n  },\n};\n\nexport const ActionMethodsWithConfig = {\n  methods: ActionMethods,\n  ignoreHistoryForActions: [\n    'setDOM',\n    'setNodeEvent',\n    'selectNode',\n    'clearEvents',\n    'setOptions',\n    'setIndicator',\n  ] as const,\n  normalizeHistory: (state: EditorState) => {\n    /**\n     * On every undo/redo, we remove events pointing to deleted Nodes\n     */\n    Object.keys(state.events).forEach((eventName: NodeEventTypes) => {\n      const nodeIds = Array.from(state.events[eventName] || []);\n\n      nodeIds.forEach((id) => {\n        if (!state.nodes[id]) {\n          state.events[eventName].delete(id);\n        }\n      });\n    });\n\n    // Remove any invalid node[nodeId].events\n    // TODO(prev): it's really cumbersome to have to ensure state.events and state.nodes[nodeId].events are in sync\n    // Find a way to make it so that once state.events is set, state.nodes[nodeId] automatically reflects that (maybe using proxies?)\n    Object.keys(state.nodes).forEach((id) => {\n      const node = state.nodes[id];\n\n      Object.keys(node.events).forEach((eventName: NodeEventTypes) => {\n        const isEventActive = !!node.events[eventName];\n\n        if (\n          isEventActive &&\n          state.events[eventName] &&\n          !state.events[eventName].has(node.id)\n        ) {\n          node.events[eventName] = false;\n        }\n      });\n    });\n  },\n};\n\nexport type EditorStore = SubscriberAndCallbacksFor<\n  typeof ActionMethodsWithConfig,\n  typeof QueryMethods\n>;\n\nexport const useEditorStore = (\n  options: Partial<Options>,\n  patchListener: PatchListener<\n    EditorState,\n    typeof ActionMethodsWithConfig,\n    typeof QueryMethods\n  >\n): EditorStore => {\n  // TODO: fix type\n  return useMethods(\n    ActionMethodsWithConfig,\n    {\n      ...editorInitialState,\n      options: {\n        ...editorInitialState.options,\n        ...options,\n      },\n    },\n    QueryMethods,\n    patchListener\n  ) as EditorStore;\n};\n","import { ERROR_RESOLVER_NOT_AN_OBJECT, HISTORY_ACTIONS } from '@craftjs/utils';\nimport * as React from 'react';\nimport invariant from 'tiny-invariant';\n\nimport { EditorContext } from './EditorContext';\nimport { useEditorStore } from './store';\n\nimport { Events } from '../events';\nimport { Options } from '../interfaces';\n\ntype EditorProps = Partial<Options> & {\n  children?: React.ReactNode;\n};\n\n/**\n * A React Component that provides the Editor context\n */\nexport const Editor = ({ children, ...options }: EditorProps) => {\n  // we do not want to warn the user if no resolver was supplied\n  if (options.resolver !== undefined) {\n    invariant(\n      typeof options.resolver === 'object' &&\n        !Array.isArray(options.resolver) &&\n        options.resolver !== null,\n      ERROR_RESOLVER_NOT_AN_OBJECT\n    );\n  }\n\n  const optionsRef = React.useRef(options);\n\n  const context = useEditorStore(\n    optionsRef.current,\n    (state, previousState, actionPerformedWithPatches, query, normalizer) => {\n      if (!actionPerformedWithPatches) {\n        return;\n      }\n\n      const { patches, ...actionPerformed } = actionPerformedWithPatches;\n\n      for (let i = 0; i < patches.length; i++) {\n        const { path } = patches[i];\n        const isModifyingNodeData =\n          path.length > 2 && path[0] === 'nodes' && path[2] === 'data';\n\n        let actionType = actionPerformed.type;\n\n        if (\n          [HISTORY_ACTIONS.IGNORE, HISTORY_ACTIONS.THROTTLE].includes(\n            actionType\n          ) &&\n          actionPerformed.params\n        ) {\n          actionPerformed.type = actionPerformed.params[0];\n        }\n\n        if (\n          ['setState', 'deserialize'].includes(actionPerformed.type) ||\n          isModifyingNodeData\n        ) {\n          normalizer((draft) => {\n            if (state.options.normalizeNodes) {\n              state.options.normalizeNodes(\n                draft,\n                previousState,\n                actionPerformed,\n                query\n              );\n            }\n          });\n          break; // we exit the loop as soon as we find a change in node.data\n        }\n      }\n    }\n  );\n\n  // sync enabled prop with editor store options\n  React.useEffect(() => {\n    if (!context) {\n      return;\n    }\n\n    if (\n      options.enabled === undefined ||\n      context.query.getOptions().enabled === options.enabled\n    ) {\n      return;\n    }\n\n    context.actions.setOptions((editorOptions) => {\n      editorOptions.enabled = options.enabled;\n    });\n  }, [context, options.enabled]);\n\n  React.useEffect(() => {\n    context.subscribe(\n      (_) => ({\n        json: context.query.serialize(),\n      }),\n      () => {\n        context.query.getOptions().onNodesChange(context.query);\n      }\n    );\n  }, [context]);\n\n  if (!context) {\n    return null;\n  }\n\n  return (\n    <EditorContext.Provider value={context}>\n      <Events>{children}</Events>\n    </EditorContext.Provider>\n  );\n};\n","import cloneDeep from 'lodash/cloneDeep';\n\nimport { createNode } from './createNode';\n\nimport { editorInitialState } from '../editor/store';\nimport { Nodes } from '../interfaces';\n\nconst getTestNode = (parentNode) => {\n  const {\n    events,\n    data: { nodes: childNodes, linkedNodes },\n    ...restParentNode\n  } = parentNode;\n  const validParentNode = createNode(cloneDeep(parentNode));\n  parentNode = {\n    ...validParentNode,\n    ...restParentNode,\n    events: {\n      ...validParentNode.events,\n      ...events,\n    },\n    dom: parentNode.dom || validParentNode.dom,\n  };\n\n  return {\n    node: parentNode,\n    childNodes,\n    linkedNodes,\n  };\n};\n\nexport const expectEditorState = (lhs, rhs) => {\n  const { nodes: nodesRhs, ...restRhs } = rhs;\n  const { nodes: nodesLhs, ...restLhs } = lhs;\n  expect(restLhs).toEqual(restRhs);\n\n  const nodesRhsSimplified = Object.keys(nodesRhs).reduce((accum, id) => {\n    const { _hydrationTimestamp, rules, ...node } = nodesRhs[id];\n    accum[id] = node;\n    return accum;\n  }, {});\n\n  const nodesLhsSimplified = Object.keys(nodesLhs).reduce((accum, id) => {\n    const { _hydrationTimestamp, rules, ...node } = nodesLhs[id];\n    accum[id] = node;\n    return accum;\n  }, {});\n\n  expect(nodesLhsSimplified).toEqual(nodesRhsSimplified);\n};\n\nexport const createTestNodes = (rootNode): Nodes => {\n  const nodes = {};\n  const iterateNodes = (testNode) => {\n    const { node: parentNode, childNodes, linkedNodes } = getTestNode(testNode);\n    nodes[parentNode.id] = parentNode;\n\n    if (childNodes) {\n      childNodes.forEach((childTestNode, i) => {\n        const {\n          node: childNode,\n          childNodes: grandChildNodes,\n          linkedNodes: grandChildLinkedNodes,\n        } = getTestNode(childTestNode);\n        childNode.data.parent = parentNode.id;\n        nodes[childNode.id] = childNode;\n        parentNode.data.nodes[i] = childNode.id;\n        iterateNodes({\n          ...childNode,\n          data: {\n            ...childNode.data,\n            nodes: grandChildNodes || [],\n            linkedNodes: grandChildLinkedNodes || {},\n          },\n        });\n      });\n    }\n\n    if (linkedNodes) {\n      Object.keys(linkedNodes).forEach((linkedId) => {\n        const {\n          node: childNode,\n          childNodes: grandChildNodes,\n          linkedNodes: grandChildLinkedNodes,\n        } = getTestNode(linkedNodes[linkedId]);\n        parentNode.data.linkedNodes[linkedId] = childNode.id;\n\n        childNode.data.parent = parentNode.id;\n        nodes[childNode.id] = childNode;\n        iterateNodes({\n          ...childNode,\n          data: {\n            ...childNode.data,\n            nodes: grandChildNodes || [],\n            linkedNodes: grandChildLinkedNodes || {},\n          },\n        });\n      });\n    }\n  };\n\n  iterateNodes(rootNode);\n\n  return nodes;\n};\n\nexport const createTestState = (state = {} as any) => {\n  const { nodes: rootNode, events } = state;\n\n  return {\n    ...editorInitialState,\n    ...state,\n    nodes: rootNode ? createTestNodes(rootNode) : {},\n    events: {\n      ...editorInitialState.events,\n      ...(events || {}),\n    },\n  };\n};\n"],"names":["React","EventHandlerContext","createContext","useEventHandler","useContext","useInternalEditor","collector","handler","store","EditorContext","invariant","ERROR_USE_EDITOR_OUTSIDE_OF_EDITOR_CONTEXT","collected","useCollector","connectorsUsage","useMemo","createConnectorsUsage","useEffect","register","cleanup","connectors","wrapConnectorHooks","_objectSpread","inContext","useInternalNode","collect","context","NodeContext","ERROR_USE_NODE_OUTSIDE_OF_EDITOR_CONTEXT","id","related","_useInternalEditor","state","nodes","actions","EditorActions","query","editorConnectors","_objectWithoutProperties","_excluded","connect","dom","drag","setProp","cb","throttleRate","history","throttle","setCustom","setHidden","bool","inNodeContext","useNode","_useInternalNode","deprecationWarning","suggest","Element","NodeSelectorType","fromEntries","pairs","Object","reduce","accum","_ref","value","getNodesFromSelector","selector","config","items","Array","isArray","mergedConfig","existOnly","idOnly","nodeSelectors","filter","item","map","node","exists","length","ERROR_INVALID_NODEID","removeNodeFromEvents","nodeId","keys","events","forEach","key","eventSet","has","Set","from","Methods","addNodeTreeToParent","tree","parentId","addNodeType","iterateChildren","data","type","options","resolver","name","ERROR_NOT_IN_RESOLVER","replace","concat","parent","props","children","childNodeId","values","linkedNodes","linkedNodeId","rootNodeId","ROOT_NODE","getParentAndValidate","index","splice","push","ERROR_NOPARENT","deleteNode","targetNode","parentNode","childId","isChildNode","includes","parentChildren","indexOf","linkedId","find","addLinkedNodeFromTree","existingLinkedNode","add","nodeToAdd","addNodeTree","delete","targets","isTopLevelNode","ERROR_DELETE_TOP_LEVEL_NODE","deserialize","input","dehydratedNodes","JSON","parse","nodePairs","DEPRECATED_ROOT_NODE","parseSerializedNode","toNode","replaceNodes","move","newParentId","newParent","nodesArrToCleanup","_ref2","i","targetId","currentParentId","isDroppable","err","Error","onBeforeMoveEnd","currentParent","currentParentNodes","oldIndex","reverse","clearEvents","setNodeEvent","setIndicator","reset","setOptions","eventType","nodeIdSelector","nodeIds","_ref3","_ref4","custom","setDOM","indicator","placement","currentNode","hidden","_ref5","selectNode","_ref6","ActionMethods","setState","_this","EventHelpers","event","contains","isEmpty","all","first","last","size","at","raw","CACHED_RESOLVER_DATA","getReversedResolver","reversed","Map","comp","entries","set","getComponentName","component","displayName","searchComponentInResolver","get","undefined","resolveComponent","resolvedName","NodeHelpers","ERROR_INVALID_NODE_ID","nodeHelpers","isCanvas","isRoot","isLinkedNode","isDeletable","isParentOfTopLevelNodes","isParentOfTopLevelCanvas","isSelected","selected","isHovered","hovered","isDragged","dragged","ancestors","deep","arguments","appendParentNode","depth","descendants","includeOnly","appendChildNode","childNodes","isDraggable","onError","ERROR_MOVE_TOP_LEVEL_NODE","ERROR_MOVE_NONCANVAS_CHILD","rules","canDrag","ERROR_CANNOT_DRAG","newParentNode","ERROR_MOVE_TO_NONCANVAS_PARENT","canMoveIn","ERROR_MOVE_INCOMING_PARENT","parentNodes","canDrop","ERROR_MOVE_CANNOT_DROP","targetDeepNodes","ERROR_MOVE_TO_DESCENDANT","currentParentNode","ERROR_DUPLICATE_NODEID","parentNodeId","canMoveOut","ERROR_MOVE_OUTGOING_PARENT","toSerializedNode","serializeNode","toNodeTree","descendantId","decendants","isTopLevelCanvas","findPosition","dims","posX","posY","result","where","leftLimit","xLimit","dimRight","yLimit","xCenter","yCenter","dimDown","len","dim","left","outerWidth","top","outerHeight","inFlow","getNodeTypeName","createNode","newNode","normalize","actualType","getRandomNodeId","_hydrationTimestamp","Date","now","info","Canvas","mergedProps","defaultElementProps","elementPropToNodeData","usingDeprecatedCanvas","deprecateCanvasComponent","userComponentConfig","craft","defaultProps","relatedNodeContext","createElement","NodeProvider","CoreEventHandlers","EventHandlers","handlers","el","select","hover","drop","create","UserElement","DerivedCoreEventHandlers","DerivedEventHandlers","documentDragoverEventHandler","e","preventDefault","Positioner","constructor","dragTarget","_defineProperty","currentDropTargetId","currentDropTargetCanvasAncestorId","currentTargetId","currentTargetChildDimensions","currentIndicator","dragError","draggedNodes","getDraggedNodes","validateDraggedNodes","onScrollListener","onScroll","bind","window","addEventListener","removeEventListener","scrollBody","target","rootNode","shouldClearChildDimensionsCache","getNodes","isNearBorders","domInfo","x","y","bottom","right","BORDER_OFFSET","isDiff","newPosition","getChildDimensions","existingTargetChildDimensions","getDOMInfo","getCanvasAncestor","dropTargetId","getCanvas","computeIndicator","position","error","sourceNode","dropError","currentNodeId","getIndicator","createShadow","shadowsToCreate","forceSingleShadow","width","height","getBoundingClientRect","shadow","cloneNode","style","pointerEvents","classList","document","body","appendChild","dataTransfer","setDragImage","container","clientX","clientY","DefaultEventHandlers","onDisable","reflect","unbindOnMouseDown","addCraftEventListener","stopPropagation","newSelectedElementIds","selectedElementIds","getEvent","isMultiSelect","isMultiSelectEnabled","selectedId","unbindOnClick","isNodeAlreadySelected","currentSelectedElementIds","unbindMouseover","unbindMouseleave","removeHoverOnMouseleave","unbindDragOver","positioner","unbindDragEnter","setAttribute","unbindDragStart","selectedDOMs","draggedElementShadow","forceSingleDragShadow","unbindDragEnd","dropElement","userElement","isValidElement","parseReactElement","currentTarget","isFunction","onCreate","removeAttribute","onDropNode","removeChild","isChromium","isLinux","movePlaceholder","pos","canvasDOMInfo","bestTargetDomInfo","thickness","t","l","w","h","mode","elDim","padding","margin","Math","max","getTestNode","restParentNode","validParentNode","cloneDeep","expectEditorState","lhs","rhs","nodesRhs","restRhs","_excluded2","nodesLhs","restLhs","_excluded3","expect","toEqual","nodesRhsSimplified","_nodesRhs$id","_excluded4","nodesLhsSimplified","_nodesLhs$id","_excluded5","createTestNodes","iterateNodes","testNode","childTestNode","childNode","grandChildNodes","grandChildLinkedNodes","createTestState","editorInitialState"],"mappings":"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"}